# 4.登录页面-用户列表



先处理一下小问题，将欢迎的用户颜色改变一下

![1639719797506](../../../../.vuepress/public/images/1639719797506.png)





如果使用一个区域管理员登录的话--查看他的用户管理--发现可以管理全部的用户，这就有问题了

​		区域管理员--他其实应该只能添加或者编辑自己区域下的用户权限

![1639721751201](../../../../.vuepress/public/images/1639721751201.png)





而且如果是区域管理员在新增用户的时候--应该只能新增自己区域内的用户-其他区域是不可以选的

![1639722003518](../../../../.vuepress/public/images/1639722003518.png)







#### 1、处理用户列表问题

​		首先分析原因：在userList中全部展示用户这个就不对



我们在请求用户列表的时候-其实就应该过滤一下条件，而不是加载全部用户列表

![1639722222891](../../../../.vuepress/public/images/1639722222891.png)





由于我们使用的是JSONServer做后端--所以这个过滤就前端来处理吧---按正常是后端来进行处理及返回的



我们先将用户token保存的数据获取--然后结构一下我们需要的数据

​		需要roleid来判断权限，需要region来判断区域

![1639722509221](../../../../.vuepress/public/images/1639722509221.png)





我们根据roleId来进行判断--如果直接使用roleId===1这种看起来有点迷糊，我们可以定义一个映射对象来区分一下



​	判断如果是超级管理员就返回全部的用户列表

![1639722748392](../../../../.vuepress/public/images/1639722748392.png)



判断如果不是超级管理员的情况

​		1、展示自己item.username===结构出来的username

​		2、过滤和我是同一区域下的，&&并且roleId为3 也就是普通用户的角色

![1639722928686](../../../../.vuepress/public/images/1639722928686.png)





页面查看一下效果：

![1639723185450](../../../../.vuepress/public/images/1639723185450.png)





显示正常--但是有些警告

![1639723578570](../../../../.vuepress/public/images/1639723578570.png)

由于hooks写法可能会--页面有警告-说没有告诉他使用的这些值，我们传入告诉他一下解决警告

![1639723372641](../../../../.vuepress/public/images/1639723372641.png)







#### 2、解决添加用户时的选择问题处理

![1639723815647](../../../../.vuepress/public/images/1639723815647.png)



问题原因分析：我们在表单的处理中也需要过滤一下，我们还需要将添加和更新的逻辑分开一下



我们给Form传入的时候--传入一个指标来判断是新增的还是更新的 isUpdate是true就是更新操作

![1639724273660](../../../../.vuepress/public/images/1639724273660.png)





我们先测试一下当更新的时候 isUpdate是true

如果是超级管理员--就return false ， 就说明disable是false 不禁用

如果不是超级管理员---返回true为禁用

![1639724475490](../../../../.vuepress/public/images/1639724475490.png)





页面查看效果：发现区域已经没有修改的权限了，只能是自己所在的区域

![1639725469908](../../../../.vuepress/public/images/1639725469908.png)





超级管理员是不受限制的

![1639725627022](../../../../.vuepress/public/images/1639725627022.png)





限制我们处理另外一个分支--创建用户的时候

​		如果是超级管理员没有限制都可以选择

​		如果不是超级管理员--将不属于自己所属区域的其他区域禁用



将item传入--用于后续判断处理

![1639726084671](../../../../.vuepress/public/images/1639726084671.png)



![1639726129440](../../../../.vuepress/public/images/1639726129440.png)





现在我们页面查看一下效果： 添加用户的时候显示的为自己的区域

![1639726277395](../../../../.vuepress/public/images/1639726277395.png)









#### 3、处理角色Select选项

​	同理--我们也需要处理一下角色的select下拉框

​		定义一个checkRoleDisable函数

![1639726453906](../../../../.vuepress/public/images/1639726453906.png)



函数分支处理

![1639726667515](../../../../.vuepress/public/images/1639726667515.png)



页面查看效果：好使的 区域管理员只能创建 区域编辑用户

![1639726721428](../../../../.vuepress/public/images/1639726721428.png)

















