# 16.草稿箱-更新新闻

​	在草稿箱中我们可以点击更新按钮--然后进行新闻的更新

![1640054274038](../../../../.vuepress/public/images/1640054274038.png)





点击更新按钮-添加事件--跳转到更新页面

​		跳转到我们这个路由中，但是我们好像没有配置这个路由

![1640054410516](../../../../.vuepress/public/images/1640054410516.png)



配置一下路由：

![1640054658353](../../../../.vuepress/public/images/1640054658353.png)





创建一个新闻更新的组件newsUpdate.js

![1640054610810](../../../../.vuepress/public/images/1640054610810.png)





点击编辑查看效果：没有问题可以跳转

![1640054752872](../../../../.vuepress/public/images/1640054752872.png)





更新和新增其实基本使用的差不多，我们可以copy一下新增的组件，复用一下



更新是支持返回的-我们设置一下返回

![1640055034905](../../../../.vuepress/public/images/1640055034905.png)





页面查看效果：点击返回也是可以返回到草稿箱的

![1640055128572](../../../../.vuepress/public/images/1640055128572.png)







我们现在发起请求然后设置一下值----设置值分为俩块 1设置新闻内容，2设置表单内容

![1640056263039](../../../../.vuepress/public/images/1640056263039.png)





Form表单内容可以回显了

![1640055541460](../../../../.vuepress/public/images/1640055541460.png)



content内容我们也可以直接结构出来

![1640056780323](../../../../.vuepress/public/images/1640056780323.png)





设置content内容--需要父传子的的方式传给NewsEditor组件

![1640056670170](../../../../.vuepress/public/images/1640056670170.png)





我们先把content这个值设置一下：然后再进行父子传值

![1640056848089](../../../../.vuepress/public/images/1640056848089.png)



现在我们给子组件传入过去

![1640056918660](../../../../.vuepress/public/images/1640056918660.png)



https://www.bilibili.com/video/BV13v411H74b?p=45&spm_id_from=pageDriver















#### 2、设置回显的Content值

​	content的值已经从父组件传入到子组件中

现在有个问题，就是我们拿到的content是一个html片段，html片段可以直接放入回显吗？肯定是不能的

​	我们需要将这个html片段再次转换成drift对象然后放入富文本编辑器中才可以



先接收一下这个值--打印一下

![1640057330178](../../../../.vuepress/public/images/1640057330178.png)



注意：你使用useEffect你用我还得依赖我

![1640058937421](../../../../.vuepress/public/images/1640058937421.png)



我们拿到这个值了：

![1640058967574](../../../../.vuepress/public/images/1640058967574.png)





我们需要将这个html片段转换为drift然后再转换为我们的setEditorState

​		我们需要看一下这个文档来看一下如何的转化

![1640059175284](../../../../.vuepress/public/images/1640059175284.png)





还需要下载一个模块 html-to-driftjs

![1640059406376](../../../../.vuepress/public/images/1640059406376.png)





![1640059555240](../../../../.vuepress/public/images/1640059555240.png)





运行查看效果：

点击下一步--成功了

![1640059599027](../../../../.vuepress/public/images/1640059599027.png)





我们现在更想是好了--但是在点击撰写新闻的时候--发生报错了

​		这个报错是咱们下载的第三方模块-draft.js报的

![1640071415241](../../../../.vuepress/public/images/1640071415241.png)



原因是： 在添加新闻的时候也会给子组件传入值，但是传入的还是空的，然后htmlToDraft转换了一个空的html导致的错误，我们来给做个数据的校验

![1640071754613](../../../../.vuepress/public/images/1640071754613.png)



如果html片段是空的就return就ok了

![1640072077570](../../../../.vuepress/public/images/1640072077570.png)





​		首先-感谢超姐组织安排的这次聚餐，也感谢超姐姐一直对我的信任，也感谢大家对工作的支持和配合。

我简单的说几句--大家都是做开发的，我也是普通的开发人员而已，只不过现在除了开发可能也做一些辅助大家工作的事情，我希望大家每天都能有点收获，在工作中有遇到什么问题我们互相探讨，互相学习，有什么需要我的就直接说事情就好了，我尽量帮大家解决，我解决不了的问题我们找超姐解决。行，然后趁今天大家都有时间也都能聚集在这里，下面我们就敞开心扉的聊，敞开肚子的吃喝。



























































































































































































































































