# 5.路由权限-本地映射表



我们现在来看路由这部分了

​		现在虽然有些菜单我们是根据权限控制了，但是我们如果知道请求地址还是可以进入访问的--那么这就有问题了--我们需要动态的创建路由

![1639727183449](../../../../.vuepress/public/images/1639727183449.png)







#### 1、动态创建路由

​		1.需要后端给我们返回权限列表，2.我们本地需要有一个映射表，3.还需要我们登录账户的一个表

最后这3个表进行匹配，最终才能得到我们需要的路由表



新创建一个路由文件--如果写在之前的路由文件中可能有点乱，这个路由是登录之后的路由，并不是之前配置的路由

​	创建NewRoulter 新闻路由	输入RFC 快捷键代码生成函数组件

![1639727990191](../../../../.vuepress/public/images/1639727990191.png)



![1639728003676](../../../../.vuepress/public/images/1639728003676.png)



我们把之前的整个Switch切走

![1639729088343](../../../../.vuepress/public/images/1639729088343.png)



然后把新的组件导入进来--NewsRouter，后续我们就用这个进行动态的路由管理

![1639729155209](../../../../.vuepress/public/images/1639729155209.png)



现在有显示权限和侧边栏的路由是没有问题的

![1639730074944](../../../../.vuepress/public/images/1639730074944.png)





#### 2、开始动态展示路由

​		我们不应该这样全部展示的路由去操作

![1639730197872](../../../../.vuepress/public/images/1639730197872.png)





分析：后端只会给我们返回路径--所以我们需要在我们本地构建一个本地路由 结构

![1639730397150](../../../../.vuepress/public/images/1639730397150.png)







比如：/home 他的值就是Home组件--将来后端给我们返回/home，我们就给他映射到Home组件

![1639730521154](../../../../.vuepress/public/images/1639730521154.png)



我们把需要映射的路由组件都写进来

![1639730961848](../../../../.vuepress/public/images/1639730961848.png)





我们创建好对应的文件夹--然后创建这些需要的组件

​		分为三块 ：新闻管理，发布管理，审核管理

![1639731112331](../../../../.vuepress/public/images/1639731112331.png)







我们现在想要后端给我们返回一个 平铺效果的路由集合，而不是现在嵌套的方式，如果给的是嵌套的那么只能在前端做一些扁平化的处理



我们将俩张表的数据进行一下合并处理就可以了

​		定义俩个变量用来接收2个接口的数据

​		同时发起2个请求并且都返回结果后我们再进行处理使用Promise.all这个函数进行处理

![1639731863398](../../../../.vuepress/public/images/1639731863398.png)

res 返回将会是一个数组，下标是0的为第一个请求返回的数据，下标为1的是第二个请求返回的数据



返回2个数据没有问题

![1639732091371](../../../../.vuepress/public/images/1639732091371.png)



我们合并一下，然后查看一下合并后的数据

![1639732183903](../../../../.vuepress/public/images/1639732183903.png)





27个数据也是我们需要的这样扁平化的数据--合并没有问题

![1639732266389](../../../../.vuepress/public/images/1639732266389.png)





我们将这些后端返回的路由集合遍历一下

​		然后path路由地址就是item.key， component组件就用到我们的本地路由配置表LocalRouterMap来映射一下组件。

![1639735478263](../../../../.vuepress/public/images/1639735478263.png)





页面测试一下效果：发现右侧都是空白的--怎么路径没有匹配到呢

![1639735722035](../../../../.vuepress/public/images/1639735722035.png)



页面内容路由不显示的原因是：

​	像这样的路径是能够完全匹配到二级路径的，因为我们在React使用的是模糊匹配，我们使用的Switch就先匹配到他，而真正的路径就不匹配了--如何避免这个问题呢？因为后端给我们返回的包括一级二级等菜单

​	解决方案就是我们使用精确匹配 加入exact属性

比如这个路径：

![1639839161073](../../../../.vuepress/public/images/1639839161073.png)





加入精确匹配：

![1639839400775](../../../../.vuepress/public/images/1639839400775.png)



页面再次测试一下：显示没有问题了

![1639839463599](../../../../.vuepress/public/images/1639839463599.png)



有可能出现403的问题：403在控制台一闪而过，原因是在路由没有完全循环加载完成的时候，会加载一下Nopermission组件，所以我们进行一下长度判断再加载403组件

![1639839580467](../../../../.vuepress/public/images/1639839580467.png)







#### 2、判断是否拥有路由权限

​	接下来我们进行路由权限的判断--有权限正常显示，没有就返回403组件

![1639839911561](../../../../.vuepress/public/images/1639839911561.png)



判断开关是否打开的checkRoute，判断当前用户是否有这个路由权限checkUserPermission

![1639840081959](../../../../.vuepress/public/images/1639840081959.png)



这俩个函数如何写---我们放在下一个笔记中



https://www.bilibili.com/video/BV13v411H74b?p=34&spm_id_from=pageDriver





















































































https://www.bilibili.com/video/BV13v411H74b?p=34&spm_id_from=pageDriver











































































