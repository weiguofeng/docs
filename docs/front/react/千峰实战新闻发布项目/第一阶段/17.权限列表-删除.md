# 17.权限列表-删除

我们之前已经完成到这个权限列表展示完成了

![1638842198182](../../../../.vuepress/public/images/1638842198182.png)





我们现在需要做一下权限列表的删除功能---而且这个删除功能是联动的，如果删除掉那么在菜单显示中是要去除掉这个权限的

![1638843705999](../../../../.vuepress/public/images/1638843705999.png)





我们现在需要绑定一个事件--然后弹出一个确认框

![1638844185615](../../../../.vuepress/public/images/1638844185615.png)



创建confirm这个函数

![1638844214969](../../../../.vuepress/public/images/1638844214969.png)



然后到文档库中--找一下确认框

​	有气泡框

![1638843984531](../../../../.vuepress/public/images/1638843984531.png)





对话框--我们使用对话框比较合适

![1638844056788](../../../../.vuepress/public/images/1638844056788.png)



![1638844104319](../../../../.vuepress/public/images/1638844104319.png)





我们现在查看一下页面的效果：

![1638844267401](../../../../.vuepress/public/images/1638844267401.png)



我们现在需要的是要删除那条数据呢？

我们在Table组件中使用形参item来接收到的就是整个对象，如果传的是key字段的那就是一个字段

![1638844702865](../../../../.vuepress/public/images/1638844702865.png)

![1638844734982](../../../../.vuepress/public/images/1638844734982.png)





删除的方法：deleteMethod

![1638844777984](../../../../.vuepress/public/images/1638844777984.png)



页面查看控制台输出：可以拿到整个对象

![1638844856920](../../../../.vuepress/public/images/1638844856920.png)





当我们点击确认删除的时候，当前页面是需要同步状态，并且后端需要同步数据



现在我们怎么做删除后在列表立即消失呢？

​	我们将DataSource的状态设置一下，注意React中不让设置原状态，所以我们使用filter来处理，使用filter他不影响原来的数组，而且可以把我们需要的给过滤出来

​		代码中的逻辑就是过滤id不等于item的id的全部数据

![1638845278671](../../../../.vuepress/public/images/1638845278671.png)

重新设置数据后，会触发重新render渲染



点击删除首页--点击确认---首页在列表中消失了

![1638845689685](../../../../.vuepress/public/images/1638845689685.png)



然后我们需要将后端的数据也进行删除才是真实的删除

![1638845790324](../../../../.vuepress/public/images/1638845790324.png)





加上这个后端删除后查看页面效果：点击删除首页-首页在列表中和菜单中都没有了，刷新也没有，真的删除了

![1638845879742](../../../../.vuepress/public/images/1638845879742.png)



发现一个遗留的小问题--目前列表页面的用户管理的子菜单没有了--为什么呢？

​		原因是之前我们写死的将第一个数组中的children设置为空导致的

![1638846089334](../../../../.vuepress/public/images/1638846089334.png)

​		

​		现在我们处理一下这个问题：改为这样 循环一下判断如果 children字段中的长度为0那么就设置问空，说明他没有子菜单

![1638846190983](../../../../.vuepress/public/images/1638846190983.png)



现在用户管理有子菜单了

![1638846293704](../../../../.vuepress/public/images/1638846293704.png)

我们现在是删除一级菜单没有问题，如果删除二级菜单呢？



#### 二级菜单删除



我们先点击按钮获取下数据结构看一下

![1638846622719](../../../../.vuepress/public/images/1638846622719.png)





然后我们想到的删除的解决方案是--先根据他的rightId获取到他的全部的二级菜单，然后在这些全部的二级菜单中排除id为3的数据--这样其实就相当于删除了

​		然后我在给后端发一个删除子菜单的接口请求，就可以把这个子菜单给真实的删除掉了

​		grade是层级的意思 grade是1为第一层，2就是第二层

![1638846924845](../../../../.vuepress/public/images/1638846924845.png)



判断grade为1的时候进行1级菜单删除，else进行其他级菜单的删除

​		二级菜单的删除--先获过滤取到一级菜单及全部的二级菜单---》然后第二次过滤就是将二级菜单的id过滤出来并且去掉---然后赋值给list.children

![1638847327792](../../../../.vuepress/public/images/1638847327792.png

![1638856621708](../../../../.vuepress/public/images/1638856621708.png)



我们测试一下：

![1638857583683](../../../../.vuepress/public/images/1638857583683.png)



children里面就少了 删除用户这一项

![1638857619830](../../../../.vuepress/public/images/1638857619830.png)

我们重新设置dataSource，因为datasource的值已经发生了改变

![1638857884499](../../../../.vuepress/public/images/1638857884499.png)

我们发现重新设置值后页面没有反应



那我们使用...DataSource这样的话,相当于重新展开赋值一下

![1638858087974](../../../../.vuepress/public/images/1638858087974.png)





然后我们把后端的数据请求接口删除掉

![1638859463653](../../../../.vuepress/public/images/1638859463653.png)









https://www.bilibili.com/video/BV13v411H74b?p=18 这节课程比较重点









































































































































