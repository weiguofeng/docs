# 20.角色列表-树形控件

目前我们已经table和删除功能已经完善了

​		现在是需要--点击编辑按钮后弹出当前角色拥有的权限

![1638965200873](../../../../.vuepress/public/images/1638965200873.png)



我们目标原型的样子是这样的：

![1638965387343](../../../../.vuepress/public/images/1638965387343.png)





首先我们需要一个树形结构的组件

![1638966248104](../../../../.vuepress/public/images/1638966248104.png)



我们需要的就是这样的树形结构--然后把他放在一个弹出的motal框中

![1638966295447](../../../../.vuepress/public/images/1638966295447.png)







代码实现：

先写一下modal

![1638966627457](../../../../.vuepress/public/images/1638966627457.png)



现在弹出框没问题

![1638966685411](../../../../.vuepress/public/images/1638966685411.png)



点击取消和叉号，需要关闭modal框，然后我们设置一下值

![1638966746181](../../../../.vuepress/public/images/1638966746181.png)





#### 2、使用树形结构

​		树形结构需要我们传入Tree这个组件 至少要有一个treeData属性数据



treeData要符合一个这样的格式

![1638966941777](../../../../.vuepress/public/images/1638966941777.png)



然后我们查看一下接口的数据--是符合这个数据结构标准的

![1638967201543](../../../../.vuepress/public/images/1638967201543.png)



请求后台数据：

![1638967314510](../../../../.vuepress/public/images/1638967314510.png)





然后我们给Tree组件设置数据

![1638967451262](../../../../.vuepress/public/images/1638967451262.png)





页面查看效果：成功了

![1638967479744](../../../../.vuepress/public/images/1638967479744.png)





我们现在测试默认选中属性defaultCheckedKeys

​		dataSource[0]是所有的权限，取的第0个角色的right的属性

![1638967748402](../../../../.vuepress/public/images/1638967748402.png)



![1638967839819](../../../../.vuepress/public/images/1638967839819.png)





查看效果：选中没有问题

![1638967928055](../../../../.vuepress/public/images/1638967928055.png)





我们需要在点击编辑按钮的时候 传入一个值-用来标识我们点击的是那个，然后弹出框显示的内容是属于哪个的

![1638968036138](../../../../.vuepress/public/images/1638968036138.png)



先定义一下当前项的Right

![1638968136774](../../../../.vuepress/public/images/1638968136774.png)



设置值：

![1638968197386](../../../../.vuepress/public/images/1638968197386.png)



现在我们不需要写死了，我们动态获取到然后测试

![1638968257670](../../../../.vuepress/public/images/1638968257670.png)



有个问题就是只有第一次是生效的----原因是**非受控组件** 使用非受控组件后续值的变化就不改变渲染页面了



我们改为受控组件

![1638968446227](../../../../.vuepress/public/images/1638968446227.png)



页面效果：好使了

![1638968477045](../../../../.vuepress/public/images/1638968477045.png)







#### 3、编辑属性

​	现在我们想点击按钮添加或者删除属性，按钮点击无效的--原因是他是受控组件

![1638968566899](../../../../.vuepress/public/images/1638968566899.png)



我们想要实现这个功能--就需要一个点击可以触发的事件-然后通过这个事件去修改值进行勾选状态的覆盖

![1638968731290](../../../../.vuepress/public/images/1638968731290.png)



使用onCheck属性

![1638968778966](../../../../.vuepress/public/images/1638968778966.png)



定义一个onCheck函数--我们打印一下看一下获取到点击的数据是什么

![1638968840461](../../../../.vuepress/public/images/1638968840461.png)



在我们点击取消勾拳的按钮-不断点击各个发现数据是会变少的

​		而且你点击取消后--返回的是新的剩余的数据，点击取消勾选的哪项是没有的

![1638968959027](../../../../.vuepress/public/images/1638968959027.png)





其实利用这个新的数据再给当前展示的树结构进行赋值然后渲染

​		因为是受控组件，得到新的值就会重新渲染

![1638969110833](../../../../.vuepress/public/images/1638969110833.png)



现在我们点击勾选框，好使了

![1638969178452](../../../../.vuepress/public/images/1638969178452.png)



现在有个问题就是可能我们子项中有三项--其中2项数据应该是勾选的，但是显示默认勾选是三项，这就是有问题的



这个问题的解决办法是使用checkstrictly这个属性处理--设置为true后就父子节点选中状态不再关联

![1638969416807](../../../../.vuepress/public/images/1638969416807.png)





![1638969464489](../../../../.vuepress/public/images/1638969464489.png)





页面查看效果： 审核新闻这项并没有勾选，说明和后端返回数据显示一致，这就说明父子按钮已经不再关联 了

![1638969577287](../../../../.vuepress/public/images/1638969577287.png)



当然不关联有个弊端就是你全部选中或者全部取消，父节点是不会关联选中和取消选中的

![1638969710319](../../../../.vuepress/public/images/1638969710319.png)

















