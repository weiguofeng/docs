# 26.用户列表-编辑用户



​		接下来我们需要做的是：

​				编辑用户，用户的开关--如果用户开关关闭后，用户再想登陆就登陆不了了，需要和登录关联

![1639554539532](../../../../.vuepress/public/images/1639554539532.png)



现在首先要处理的就是 因为开关是受控组件，目前是关闭不掉的



#### 1、处理受控开关Switch

​		我们给switch添加一个事件---将item传入进去

![1639554808733](../../../../.vuepress/public/images/1639554808733.png)



这样传入过来item我们就知道那一项是需要改为关的状态，然后我们再同步我们的后端，再修改当前的页面

![1639555130106](../../../../.vuepress/public/images/1639555130106.png)



查看一下item--可以获取到整个对象

![1639555185681](../../../../.vuepress/public/images/1639555185681.png)



我们只需要将roleState改为false然后去同步后端

![1639555232735](../../../../.vuepress/public/images/1639555232735.png)



比较简单的做法就是 我们将这个值取反就可以了

​			然后我们重新设置值 展开数据

![1639555342039](../../../../.vuepress/public/images/1639555342039.png)





这回页面就可以关闭了---但是刷新页面显回原型 因为没有同步后端

![1639555517637](../../../../.vuepress/public/images/1639555517637.png)





使用补丁请求--patch 进行更新--更新roleState

![1639557015440](../../../../.vuepress/public/images/1639557015440.png)



我们重新刷新页面后，关闭或者开启的按钮是不变的，因为已经和后台数据同步了

![1639557097421](../../../../.vuepress/public/images/1639557097421.png)









#### 2、然后点击编辑按钮进行更新

​			点击编辑按钮--需要把内容回显--和新增一样，整一个模态框出来



![1639557732687](../../../../.vuepress/public/images/1639557732687.png)



设置模态框

![1639557877992](../../../../.vuepress/public/images/1639557877992.png)



将定义的数据开始创建

![1639557979123](../../../../.vuepress/public/images/1639557979123.png)



点击编辑按钮--将模态框的显示设置为true 然后打开模态框

![1639558088627](../../../../.vuepress/public/images/1639558088627.png)





页面查看效果：

![1639558134596](../../../../.vuepress/public/images/1639558134596.png)





然后我们给Form表单内容回显设置值 -- 使用 setFieldsValue这个方法设置，需要传入对象

![1639558298677](../../../../.vuepress/public/images/1639558298677.png)





然后点击编辑按钮--查看效果---显示正确---结果一刷新就有问题了，因为是热更新的--我们在弹出模态框的时候

![1639558371125](../../../../.vuepress/public/images/1639558371125.png)



我们现在处理异步--改为同步处理 --模态框及表单创建完成后 表单进行内容的填充

​		我们房子异步中设置延迟settime 只要在异步中patchUpdate批量的标志位就会自动为false，就不会进行批量合并，这个时候就变成了同步处理方案了

![1639560293989](../../../../.vuepress/public/images/1639560293989.png)







测试查看效果： 没有问题--点击刷新也没有问题

![1639560343443](../../../../.vuepress/public/images/1639560343443.png)



注意：React中您别以为你刚更新完State 你的dom呢就好了，你的状态组件都完事了，这怎么可能呢，所以说这种方案来说setTime 是经常用的到的，让他变为同步触发。





设置isUpdateDisable 初始值为false--用于 传给子组件--然后用于设置子组件中是否禁用地域标志

![1639560750789](../../../../.vuepress/public/images/1639560750789.png)



判断一下角色--然后将是否禁用设置值

![1639566458738](../../../../.vuepress/public/images/1639566458738.png)



然后在更新的时候给Form组件传入这个值---用于区别是新增还是更新

![1639560886690](../../../../.vuepress/public/images/1639560886690.png)





传入这个值后--重新设置一下这个值，如果是禁用就改为禁用

![1639566594197](../../../../.vuepress/public/images/1639566594197.png)





页面测试一下：点击编辑超级管理员--然后区域是禁用好使的

![1639566864564](../../../../.vuepress/public/images/1639566864564.png)







如果点击完超级管理员--我们关闭模态框--再次打开其他的编辑后--发现区域被禁止了

​		原因就是我们没有重新设置值，这个就是因为我们共用一个组件导致的

![1639567031297](../../../../.vuepress/public/images/1639567031297.png)





我们在点击取消的时候--还是需要设置一下值--取反

![1639567164406](../../../../.vuepress/public/images/1639567164406.png)





#### 3、提交Form表单进行修改及校验



我们先打印一下收集到修改的form表单内容

![1639567491604](../../../../.vuepress/public/images/1639567491604.png)





可以获取到最新的表单数据

![1639567559065](../../../../.vuepress/public/images/1639567559065.png)





设置变量current -- 用于编辑时候-我们把这个点击的对象值先保存下来

![1639567791638](../../../../.vuepress/public/images/1639567791638.png)





存一下这个编辑的对象到setcurrent中---在将来点击ok更新的时候使用

![1639568094234](../../../../.vuepress/public/images/1639568094234.png)



然后我们点击ok的时候--重新设置值的时候

​		判断item的id和current旧值的id是否一致，一致就代表改的就是这项

​		然后将item展开，value值展开设置值，注意还有设置角色的值

![1639568263210](../../../../.vuepress/public/images/1639568263210.png)



如果id不相等就返回item ，最后还需要设置一下禁用的值取反--否则会导致地域禁用不好使的问题

![1639568557001](../../../../.vuepress/public/images/1639568557001.png)





同步到后端---发一个patch请求 增量更新

![1639568799488](../../../../.vuepress/public/images/1639568799488.png)





然后页面查看效果：然后更新效果好使的

![1639568860775](../../../../.vuepress/public/images/1639568860775.png)











































































































