(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{6286:function(t,s,p){t.exports=p.p+"assets/img/1660635231613.709304fa.png"},6287:function(t,s,p){t.exports=p.p+"assets/img/1660635322525.ff262047.png"},6288:function(t,s,p){t.exports=p.p+"assets/img/1660635510343.6ddd80a2.png"},6289:function(t,s,p){t.exports=p.p+"assets/img/1660635585050.7e01331a.png"},6290:function(t,s,p){t.exports=p.p+"assets/img/1660635754104.c7125a7a.png"},6291:function(t,s,p){t.exports=p.p+"assets/img/1660635874012.2677695e.png"},6292:function(t,s,p){t.exports=p.p+"assets/img/1660640827746.b6338a56.png"},6293:function(t,s,p){t.exports=p.p+"assets/img/1660640879793.5fa1f7ab.png"},6294:function(t,s,p){t.exports=p.p+"assets/img/1660641005335.dcb4d879.png"},6295:function(t,s,p){t.exports=p.p+"assets/img/1660641101210.8d7a52ef.png"},6296:function(t,s,p){t.exports=p.p+"assets/img/1660641174089.34c9eee9.png"},6297:function(t,s,p){t.exports=p.p+"assets/img/1660641351543.d7d30b66.png"},6298:function(t,s,p){t.exports=p.p+"assets/img/1660641376914.a811f705.png"},6299:function(t,s,p){t.exports=p.p+"assets/img/1660641480158.b7630a09.png"},6300:function(t,s,p){t.exports=p.p+"assets/img/1660641529274.0eab3701.png"},6301:function(t,s,p){t.exports=p.p+"assets/img/1660641608680.002f97af.png"},6302:function(t,s,p){t.exports=p.p+"assets/img/1660641747906.0b8903a0.png"},6303:function(t,s,p){t.exports=p.p+"assets/img/1660641896747.40c3317f.png"},6304:function(t,s,p){t.exports=p.p+"assets/img/1660642006309.3ab0bf75.png"},6305:function(t,s,p){t.exports=p.p+"assets/img/1660642169173.b9a55a45.png"},6306:function(t,s,p){t.exports=p.p+"assets/img/1660642224472.2f6665fe.png"},6307:function(t,s,p){t.exports=p.p+"assets/img/1660642277921.f5391bd2.png"},6308:function(t,s,p){t.exports=p.p+"assets/img/1660642371268.e4bf4c33.png"},6309:function(t,s,p){t.exports=p.p+"assets/img/1660642608680.87c26dbb.png"},6310:function(t,s,p){t.exports=p.p+"assets/img/1660642718496.4d02d793.png"},6311:function(t,s,p){t.exports=p.p+"assets/img/1660642832540.68586eae.png"},6312:function(t,s,p){t.exports=p.p+"assets/img/1660642860722.44825648.png"},6313:function(t,s,p){t.exports=p.p+"assets/img/1660642956700.cf4df6f0.png"},6314:function(t,s,p){t.exports=p.p+"assets/img/1660642982608.57fca822.png"},6315:function(t,s,p){t.exports=p.p+"assets/img/1660643024396.19bad5d7.png"},6316:function(t,s,p){t.exports=p.p+"assets/img/1660643058635.7b451a3b.png"},8746:function(t,s,p){"use strict";p.r(s);var n=p(5),a=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_21、devops-jenkinsfile-部署vue-admin项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_21、devops-jenkinsfile-部署vue-admin项目"}},[t._v("#")]),t._v(" 21、devops-Jenkinsfile-部署vue-admin项目")]),t._v(" "),n("p",[t._v("​\t前面我们通过暴露我们的服务网关--屏蔽了我们后台的其他微服务，而我们也测试通过了我们的前端项目，直连网关，然后所有的请求都交给网关代理访问其他微服务，也都测试通过。")]),t._v(" "),n("p",[t._v("​\t接下来我们进行前端应用的上云，前端应用我们使用流水线上云。")]),t._v(" "),n("p",[t._v("​\t因为前端应用一般会使用到nodejs，所以我们使用kubesphere的这个带nodejs的jenkins代理，label设置为nodejs，这块是固定写法")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6286),alt:"1660635231613"}})]),t._v(" "),n("p",[t._v("我们的流水线第一步就是拉取代码，因为我们现在使用的是私库，所以拉的时候需要携带账号密码")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6287),alt:"1660635322525"}})]),t._v(" "),n("p",[t._v("​\t然后是项目编译，这里需要的是先安装项目的依赖npm install 然后再运行npm run build运行构建项目")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6288),alt:"1660635510343"}})]),t._v(" "),n("p",[t._v("​\t我们前端的项目构建完成后会产生一个dist的文件夹，里面存放html文件和一些静态资源")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6289),alt:"1660635585050"}})]),t._v(" "),n("p",[t._v("​\t\t我们把这个文件夹的内容放给任何一个http服务器，比如nginx，都可以进行访问")]),t._v(" "),n("p",[t._v("​\t然后第三步--我们进行镜像的构建---我们使用dockerfile进行项目的构建")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6290),alt:"1660635754104"}})]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​\t我们看一下这个构建的dockerfile")]),t._v(" "),n("p",[t._v("​\t\t因为我们只需要将前端的这个dist文件夹交给nginx就可以了，所以这个镜像的基础镜像是nginx")]),t._v(" "),n("p",[t._v("​\t\t然后拷贝dist文件夹，到nginx的usr/share/nginx/html的文件夹下")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6291),alt:"1660635874012"}})]),t._v(" "),n("p",[t._v("​\t\t所以这样的话，我们的nginx的这个路径下就会有我们前端的页面，并且nginx暴露的是80端口，这样nginx启动后我们就相当于把这些页面加载起来了")]),t._v(" "),n("p",[t._v("第四步：镜像的推送--把我们的镜像和后端一样也是推送到阿里云的镜像仓库中")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6292),alt:"1660640827746"}})]),t._v(" "),n("p",[t._v("第五步：进行部署，我们使用deploy.yml进行部署")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6293),alt:"1660640879793"}})]),t._v(" "),n("p",[t._v("这个部署和我们之前后端部署基本一样，只不过是项目名称有差异各自使用各子的")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6294),alt:"1660641005335"}})]),t._v(" "),n("p",[t._v("还有镜像名称的不一致，前端的端口使用80")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6295),alt:"1660641101210"}})]),t._v(" "),n("p",[t._v("Service也是暴露80端口")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6296),alt:"1660641174089"}})]),t._v(" "),n("p",[t._v("​\t这样的话，我们前端部署好之后，也会产生负载均衡网络")]),t._v(" "),n("p",[t._v("对了在部署之前我们需要修改的是前端连接生产环境的地址")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6297),alt:"1660641351543"}})]),t._v(" "),n("p",[t._v("修改生产环境的网关地址")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6298),alt:"1660641376914"}})]),t._v(" "),n("p",[t._v("我们现在开始部署：")]),t._v(" "),n("p",[t._v("​\t进入到kubesphere的devops工程，然后创建")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6299),alt:"1660641480158"}})]),t._v(" "),n("p",[t._v("​\t医院挂号的前端项目，然后我们直接选择代码仓库")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6300),alt:"1660641529274"}})]),t._v(" "),n("p",[t._v("选择我们的凭证，然后输入克隆项目的地址")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6301),alt:"1660641608680"}})]),t._v(" "),n("p",[t._v("因为我们的项目中有Jenkinsfile文件，脚本路径中输入Jenkinsfile就会给我们默认使用我们项目中的这个文件，注意文件名称的一致性--然后点击创建")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6302),alt:"1660641747906"}})]),t._v(" "),n("p",[t._v("​\t第一次构建--效率比较低一些慢一些")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6303),alt:"1660641896747"}})]),t._v(" "),n("p",[t._v("拉取代码，和项目编译都成功了，但是构建镜像的时候报错了--提示不能访问 yygh-admin这个文件夹")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6304),alt:"1660642006309"}})]),t._v(" "),n("p",[t._v("​\t因为其实他并不需要yygh-admin这个根路径的文件夹，我们去掉就可以了")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6305),alt:"1660642169173"}})]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("修改后的构建镜像步骤")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6306),alt:"1660642224472"}})]),t._v(" "),n("p",[t._v("那么其实部署的时候也是不需要这个yygh-admin文件夹的--去掉")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6307),alt:"1660642277921"}})]),t._v(" "),n("p",[t._v("​\t我们重新启动流水线--")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6308),alt:"1660642371268"}})]),t._v(" "),n("p",[t._v("​\t我们再次运行流水线后-构建镜像成功，但是推送镜像的时候发生错误了，说是和maven有关系")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6309),alt:"1660642608680"}})]),t._v(" "),n("p",[t._v("原因是我们使用的镜像不对我们使用的是maven，应该使用nodejs")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6310),alt:"1660642718496"}})]),t._v(" "),n("p",[t._v("重新运行流水线，成功了")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6311),alt:"1660642832540"}})]),t._v(" "),n("p",[t._v("并且我们收到了，构建的邮件")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6312),alt:"1660642860722"}})]),t._v(" "),n("p",[t._v("为了我们测试方便--我们编辑一下服务，设置外网访问")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6313),alt:"1660642956700"}})]),t._v(" "),n("p",[n("img",{attrs:{src:p(6314),alt:"1660642982608"}})]),t._v(" "),n("p",[t._v("我们访问一下前端项目：")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6315),alt:"1660643024396"}})]),t._v(" "),n("p",[t._v("​\t没问题，数据都是可以访问到的--我们admin的后台管理系统就部署好了")]),t._v(" "),n("p",[n("img",{attrs:{src:p(6316),alt:"1660643058635"}})]),t._v(" "),n("p",[t._v("https://www.bilibili.com/video/BV13Q4y1C7hS?p=126&spm_id_from=pageDriver&vd_source=243ad3a9b323313aa1441e5dd414a4ef")])])}),[],!1,null,null,null);s.default=a.exports}}]);