(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{769:function(t,s,a){t.exports=a.p+"assets/img/1678015407167.7b416b0e.png"},770:function(t,s,a){t.exports=a.p+"assets/img/1678016030289.ee6a0f60.png"},771:function(t,s,a){t.exports=a.p+"assets/img/1678016198634.f694aefa.png"},772:function(t,s,a){t.exports=a.p+"assets/img/1678016303134.f135c1b4.png"},773:function(t,s,a){t.exports=a.p+"assets/img/1678017328060.d0f71eb3.png"},774:function(t,s,a){t.exports=a.p+"assets/img/1678017524966.c2572a21.png"},775:function(t,s,a){t.exports=a.p+"assets/img/1678068452572.d20f63c9.png"},776:function(t,s,a){t.exports=a.p+"assets/img/1678070310329.bdd26245.png"},777:function(t,s,a){t.exports=a.p+"assets/img/1678070938718.6abe5f28.png"},778:function(t,s,a){t.exports=a.p+"assets/img/1678070966935.ef107124.png"},779:function(t,s,a){t.exports=a.p+"assets/img/1678071008188.69b39057.png"},780:function(t,s,a){t.exports=a.p+"assets/img/1678071089869.2fd2889e.png"},781:function(t,s,a){t.exports=a.p+"assets/img/1678071179669.9d8822e5.png"},782:function(t,s,a){t.exports=a.p+"assets/img/1678071518383.69fb4d49.png"},783:function(t,s,a){t.exports=a.p+"assets/img/1678071660315.5d1d2c56.png"},784:function(t,s,a){t.exports=a.p+"assets/img/1678072248103.0d65f49e.png"},785:function(t,s,a){t.exports=a.p+"assets/img/1678072415930.43880ae4.png"},786:function(t,s,a){t.exports=a.p+"assets/img/1678073311794.023e35de.png"},787:function(t,s,a){t.exports=a.p+"assets/img/1678073440443.39b50faf.png"},788:function(t,s,a){t.exports=a.p+"assets/img/1678083696595.4d8b09b4.png"},789:function(t,s,a){t.exports=a.p+"assets/img/1678084141936.a99f5040.png"},790:function(t,s,a){t.exports=a.p+"assets/img/1678084207085.12908658.png"},791:function(t,s,a){t.exports=a.p+"assets/img/1678084272311.556a808a.png"},792:function(t,s,a){t.exports=a.p+"assets/img/1678084603616.73d1dfc1.png"},793:function(t,s,a){t.exports=a.p+"assets/img/1678084686878.ac4c1deb.png"},794:function(t,s,a){t.exports=a.p+"assets/img/1678084720855.ef52b4a7.png"},8276:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"promethus介绍及前期准备工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#promethus介绍及前期准备工作"}},[t._v("#")]),t._v(" promethus介绍及前期准备工作")]),t._v(" "),n("h2",{attrs:{id:"_1、学习目标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、学习目标"}},[t._v("#")]),t._v(" 1、学习目标")]),t._v(" "),n("h4",{attrs:{id:"promethus是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#promethus是什么"}},[t._v("#")]),t._v(" promethus是什么？")]),t._v(" "),n("p",[t._v("​\t\tPromethus是由go语言（golang）开发的一套，监控+报警+时间序列数据库的组合，适合监控docker容器。")]),t._v(" "),n("p",[t._v("​\t\t因为kubernetes的流行带动了promethus的发展。")]),t._v(" "),n("p",[t._v("​\t\t他主要是负责收集服务器端数据")]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​\t普罗米修斯---背景，其实是美国的一个城市名称，西方神话中给人类带来火种的神，所以官网的logo是一个火种的样子。")]),t._v(" "),n("p",[t._v("​\t官网：https://prometheus.io/")]),t._v(" "),n("p",[n("img",{attrs:{src:a(769),alt:"1678015407167"}})]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​\t\t1、先搞定promethus的服务器安装")]),t._v(" "),n("p",[t._v("​\t\t那么怎么样才可以看到这个服务器运行的好不好呢，这个时候就需要grafana--他是图形化的可视化的界面的工具。他可以把promethus的服务器收集的数据，以图形的形式进行展现")]),t._v(" "),n("p",[t._v("​\t2、那么就需要在grafana中添加promethus的数据源")]),t._v(" "),n("p",[t._v("​\t\t\t\t监控我们的cpu、mysql，如果有时间我们还可以扩展其他监控内容")]),t._v(" "),n("p",[t._v("​\t3、grafana+onealert可以实现报警")]),t._v(" "),n("h2",{attrs:{id:"_2、任务要求-背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、任务要求-背景"}},[t._v("#")]),t._v(" 2、任务要求-背景")]),t._v(" "),n("p",[t._v("​\t"),n("img",{attrs:{src:a(770),alt:"1678016030289"}})]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​\t\t\tK8s内部使用的监控系统就是promethus")]),t._v(" "),n("h2",{attrs:{id:"_3、任务分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、任务分析"}},[t._v("#")]),t._v(" 3、任务分析")]),t._v(" "),n("p",[n("img",{attrs:{src:a(771),alt:"1678016198634"}})]),t._v(" "),n("p",[t._v("项目选型：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(772),alt:"1678016303134"}})]),t._v(" "),n("h2",{attrs:{id:"_4、时间序列数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、时间序列数据"}},[t._v("#")]),t._v(" 4、时间序列数据")]),t._v(" "),n("h3",{attrs:{id:"_1、什么是时间序列"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、什么是时间序列"}},[t._v("#")]),t._v(" 1、什么是时间序列")]),t._v(" "),n("p",[t._v("​\t\t这种其实叫做时序性数据")]),t._v(" "),n("p",[n("img",{attrs:{src:a(773),alt:"1678017328060"}})]),t._v(" "),n("h3",{attrs:{id:"_2、基于时间序列数据特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、基于时间序列数据特点"}},[t._v("#")]),t._v(" 2、基于时间序列数据特点")]),t._v(" "),n("p",[n("img",{attrs:{src:a(774),alt:"1678017524966"}})]),t._v(" "),n("p",[t._v("​\t\t他的这个优点是其他系统不敢想象的--人家这个promethus算法做的非常好，对于这种海量数据抽取监控非常有效，储存成本非常低。")]),t._v(" "),n("h3",{attrs:{id:"_3、promethus的基本特征"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、promethus的基本特征"}},[t._v("#")]),t._v(" 3、promethus的基本特征")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("多维度数据模型 -- 可以监控各种类型，多方面，多角度记录服务器信息，像CPU、内存、存储、网络等等，只要我们想到的他都可以进行监控。")])]),t._v(" "),n("li",[n("p",[t._v("查询语言比较灵活 -- 可以通过简单的数学公式来实现对数据的监控。")])]),t._v(" "),n("li",[n("p",[t._v("不依赖分布式存储，单个服务器节点是自主的 -- 单个服务器就可以实现监控了")])]),t._v(" "),n("li",[n("p",[t._v("以HTTP方式，通过pull模型拉取时间序列数据")])]),t._v(" "),n("li",[n("p",[t._v("也可以通过中间网关支持push模型")])]),t._v(" "),n("li",[n("p",[t._v("通过服务发现或者静态配置，来发现目标服务对象 -- 假设这个服务器我们可以动态的去发现，也可以静态配置比如 ip地址 用户名 密码 就可以实现监控的目的")])]),t._v(" "),n("li",[n("p",[t._v("支持多种多样的图标和界面展示")])])]),t._v(" "),n("h3",{attrs:{id:"_4、promethus原理架构图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、promethus原理架构图"}},[t._v("#")]),t._v(" 4、promethus原理架构图")]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​\t\t\t\t这个其实就是官方的doc下面的一个架构图")]),t._v(" "),n("p",[t._v("​\t\t\t这个架构图的意思就是")]),t._v(" "),n("ul",[n("li",[t._v("我们可以安装一个Promethus server 的服务")]),t._v(" "),n("li",[t._v("通过这个服务器延伸--可以结合Granfana进行图形化的展示")]),t._v(" "),n("li",[t._v("可以pull 拉取和推送监控目标系统")]),t._v(" "),n("li",[t._v("发现目标系统后--通过他的时间--序列进行数据的收集和整合")]),t._v(" "),n("li",[t._v("收集之后--一般有2个走向 1是结合granfana图像化展示 2走向Alertmanager告警管理--实现告警")])]),t._v(" "),n("p",[t._v("​\t\t\t看着挺复杂--其实实现原理相对简单")]),t._v(" "),n("p",[n("img",{attrs:{src:a(775),alt:"1678068452572"}})]),t._v(" "),n("h2",{attrs:{id:"_5、环境准备"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5、环境准备"}},[t._v("#")]),t._v(" 5、环境准备")]),t._v(" "),n("p",[t._v("​\t需要实现这个功能我们需要最少三台服务器，那么这三台服务器都是干什么呢？")]),t._v(" "),n("p",[t._v("​\t主服务器 -- promethus服务器 -- 收集数据 最终都集中在这台服务器上")]),t._v(" "),n("p",[t._v("​\t被监控服务器 -- 我们想监控的内容，来自于这台服务器")]),t._v(" "),n("p",[t._v("​\tgranfana服务器 -- 就是把promethus中的数据以图像的形式展现")]),t._v(" "),n("p",[n("img",{attrs:{src:a(776),alt:"1678070310329"}})]),t._v(" "),n("h2",{attrs:{id:"_6、克隆机器与环境规划"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6、克隆机器与环境规划"}},[t._v("#")]),t._v(" 6、克隆机器与环境规划")]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("从我们的虚拟机上 先进行克隆")]),t._v(" "),n("p",[n("img",{attrs:{src:a(777),alt:"1678070938718"}})]),t._v(" "),n("p",[t._v("​\t创建完整的克隆")]),t._v(" "),n("p",[n("img",{attrs:{src:a(778),alt:"1678070966935"}})]),t._v(" "),n("p",[t._v("​\t起名和设置存放路径")]),t._v(" "),n("p",[n("img",{attrs:{src:a(779),alt:"1678071008188"}})]),t._v(" "),n("p",[t._v("​\t再继续克隆后续的2台服务器")]),t._v(" "),n("p",[t._v("​\t这个做监控管理")]),t._v(" "),n("p",[n("img",{attrs:{src:a(780),alt:"1678071089869"}})]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("第三台服务器克隆")]),t._v(" "),n("p",[n("img",{attrs:{src:a(781),alt:"1678071179669"}})]),t._v(" "),n("p",[t._v("​\t\t现在我们这三台服务器就准备好了。")]),t._v(" "),n("p",[t._v("​\t先不要着急其他的，我们需要对整个系统先做一个规划")]),t._v(" "),n("p",[t._v("​\t\t因为我们的机器Mycat的 ip尾号是16 ，所以现在这三台服务器的ip先设置为 17   18   19")]),t._v(" "),n("p",[n("img",{attrs:{src:a(782),alt:"1678071518383"}})]),t._v(" "),n("h2",{attrs:{id:"_7、初始化服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7、初始化服务器"}},[t._v("#")]),t._v(" 7、初始化服务器")]),t._v(" "),n("p",[t._v("​\t\t先把这些服务器都启动起来")]),t._v(" "),n("p",[n("img",{attrs:{src:a(783),alt:"1678071660315"}})]),t._v(" "),n("p",[t._v("​\t现在这些服务器肯定都有问题，因为他们的uuid都是一样的，他们的主机名称也都一样，那么我们就需要做一些基本的操作")]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​\t\t"),n("strong",[t._v("IP设置、hostname设置 -- 主机名称、绑定/etc/host文件、时间同步（为什么需要时间同步-特别重要，因为我们的promethus系统就是基于时间序列的，如果一旦这台服务器的时间不符，可能造成通讯故障，数据异常）")])]),t._v(" "),n("h3",{attrs:{id:"_1、修改网卡-ip地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、修改网卡-ip地址"}},[t._v("#")]),t._v(" 1、修改网卡 -- IP地址")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("vim /etc/sysconf/network-scripts/ifcfg-ens33\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:a(784),alt:"1678072248103"}})]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# 修改UUID编号的后三位\n\n#修改dhcp -- key是 BOOTPROTO\ndhcp=>none/static\n\n#修改IP\nIPADDR 自己需要的IP\n\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("p",[n("img",{attrs:{src:a(785),alt:"1678072415930"}})]),t._v(" "),n("p",[t._v("​\t修改之后restart一下--重启网络")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("systemctl restart network\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("​\t同样的方式我们设置第二台和第三台服务器")]),t._v(" "),n("h3",{attrs:{id:"_2、工具连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、工具连接"}},[t._v("#")]),t._v(" 2、工具连接")]),t._v(" "),n("p",[t._v("​\t接下来我们就可以使用Mobaxterm 或者是 XShell工具进行连接")]),t._v(" "),n("p",[t._v("​\t点击session创建会话")]),t._v(" "),n("p",[n("img",{attrs:{src:a(786),alt:"1678073311794"}})]),t._v(" "),n("p",[t._v("​\tSSH\t\t10.1.1.17 promethus服务器")]),t._v(" "),n("p",[t._v("​\t\t\t\t\t书签设置 -- 自己起名")]),t._v(" "),n("p",[n("img",{attrs:{src:a(787),alt:"1678073440443"}})]),t._v(" "),n("p",[t._v("​\t\t后续服务器也是这样操作")]),t._v(" "),n("h3",{attrs:{id:"_3、设置hostname-主机名称"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、设置hostname-主机名称"}},[t._v("#")]),t._v(" 3、设置hostname 主机名称")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# 第一台服务器\n# hostnamectl set-hostname prometheus.itcast.cn\n\n# 第二台服务器\n# hostnamectl set-hostname agent.itcast.cn\n\n\n第三台服务器\n# hostnamectl set-hostname granfana.itcast.cn\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("p",[n("img",{attrs:{src:a(788),alt:"1678083696595"}})]),t._v(" "),n("h3",{attrs:{id:"_4、设置host文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、设置host文件"}},[t._v("#")]),t._v(" 4、设置host文件")]),t._v(" "),n("div",{staticClass:"language-pascal line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-pascal"}},[n("code",[t._v("\t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("hosts\n\n# 先把ip记录一下  然后主机名称  域名  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("最终要实现域名通信\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.17")]),t._v("   prometheus\tprometheus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.18")]),t._v("   agent\t\tagent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.19")]),t._v("\tgrafana\t\tgrafana"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("itcast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cn\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[t._v("​\t我们现在点击多窗口执行命令")]),t._v(" "),n("p",[n("img",{attrs:{src:a(789),alt:"1678084141936"}})]),t._v(" "),n("p",[t._v("编辑hosts文件")]),t._v(" "),n("p",[n("img",{attrs:{src:a(790),alt:"1678084207085"}})]),t._v(" "),n("p",[t._v("​\t设置hosts，都粘贴过去就可以了")]),t._v(" "),n("p",[n("img",{attrs:{src:a(791),alt:"1678084272311"}})]),t._v(" "),n("h3",{attrs:{id:"_5、时间同步"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5、时间同步"}},[t._v("#")]),t._v(" 5、时间同步")]),t._v(" "),n("p",[t._v("​\t\t\t这个非常重要--因为promethus就是基于时间序列的")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("\n# 先挂载文件\nmount /dev/sr0 /mnt\n\n# 安装npt时间\nyum install nptdate -y\n\n# 通过这个连接池 我们可以进行网络的连接\nnptdate cn.npt.org.cn\n\n\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("p",[n("img",{attrs:{src:a(792),alt:"1678084603616"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(793),alt:"1678084686878"}})]),t._v(" "),n("p",[t._v("​\t执行一下date时间一致没有问题")]),t._v(" "),n("p",[n("img",{attrs:{src:a(794),alt:"1678084720855"}})]),t._v(" "),n("p",[t._v("​\t这样的话 -- 我们前期的准备工作就完成了")]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​")]),t._v(" "),n("p",[t._v("​")])])}),[],!1,null,null,null);s.default=e.exports}}]);