(window.webpackJsonp=window.webpackJsonp||[]).push([[524],{6699:function(t,s,e){t.exports=e.p+"assets/img/1650964666284.67fa8725.png"},6700:function(t,s,e){t.exports=e.p+"assets/img/1650965005118.3dcbaf7c.png"},6701:function(t,s,e){t.exports=e.p+"assets/img/1650965149960.953d760d.png"},6702:function(t,s,e){t.exports=e.p+"assets/img/1650965386017.287dea90.png"},8870:function(t,s,e){"use strict";e.r(s);var n=e(5),a=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_27-k8s核心实战-工作负载-deployment版本回退能力"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_27-k8s核心实战-工作负载-deployment版本回退能力"}},[t._v("#")]),t._v(" 27.k8s核心实战-工作负载-deployment版本回退能力")]),t._v(" "),n("p",[t._v("​\t我们了解一下k8s的版本回退能力：就拿我们之前部署的deployment，my-dep来说，我们之前进行了镜像升级，我们又产生了一个版本，未来我们的应用会经常的升级，这样我们就会有很多的以前部署记录。")]),t._v(" "),n("p",[t._v("​\t然后突然我们发现这次部署的我们不满意，我们想回退到某个历史记录版本状态，我们把这种情况就叫做版本回退。")]),t._v(" "),n("h4",{attrs:{id:"版本回退"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#版本回退"}},[t._v("#")]),t._v(" 版本回退")]),t._v(" "),n("p",[t._v("​\t在k8s中想要实现版本回退也是一个命令就ok了")]),t._v(" "),n("p",[t._v("​\t我们需要先查看一下部署的历史记录，使用命令kubectl rollout history deployment/my-dep")]),t._v(" "),n("p",[t._v("​\t我们看到有打印Revision 下面有1,2就是2个版本，因为我们在升级的时候添加了--record参数，所以这里会把我们升级的命令记录显示出来")]),t._v(" "),n("p",[n("img",{attrs:{src:e(6699),alt:"1650964666284"}})]),t._v(" "),n("p",[t._v("​\t如果我们现在想要版本回退，使用"),n("strong",[t._v("kubectl rollout undo deploye/my-dep --to-reversion=1")]),t._v("这样就可以回退到第一个版本，而且这个回退也是滚动回退的")]),t._v(" "),n("p",[n("img",{attrs:{src:e(6700),alt:"1650965005118"}})]),t._v(" "),n("p",[t._v("​\t\t我们看到rolled back 进行回滚版本回退")]),t._v(" "),n("p",[t._v("​\t我们看一下这个Pod--也是滚动更新的")]),t._v(" "),n("p",[n("img",{attrs:{src:e(6701),alt:"1650965149960"}})]),t._v(" "),n("p",[t._v("​\t那么我们怎么能够确定它是否回退到之前的版本呢？我们可以使用命令将deploy以yaml输出，并且过滤image")]),t._v(" "),n("p",[t._v("​\t"),n("code",[t._v("kubectl get deploy/my-dep -oyaml | grep image")])]),t._v(" "),n("p",[t._v("​\t我们现在看到image是nginx，相当于nginx的最新版本，因为我们上个版本就是nginx最新版本，所以回退没有问题")]),t._v(" "),n("p",[n("img",{attrs:{src:e(6702),alt:"1650965386017"}})]),t._v(" "),n("p",[t._v("​\t\t版本回退需要使用到的命令")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("#历史记录\nkubectl rollout history deployment/my-dep\n\n\n#查看某个历史详情\nkubectl rollout history deployment/my-dep --revision=2\n\n#回滚(回到上次)\nkubectl rollout undo deployment/my-dep\n\n#回滚(回到指定版本)\nkubectl rollout undo deployment/my-dep --to-revision=2\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("p",[t._v("​")])])}),[],!1,null,null,null);s.default=a.exports}}]);