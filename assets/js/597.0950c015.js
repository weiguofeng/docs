(window.webpackJsonp=window.webpackJsonp||[]).push([[597],{7759:function(s,t,n){s.exports=n.p+"assets/img/1646208945259.8f84f8af.png"},7760:function(s,t,n){s.exports=n.p+"assets/img/1646211586055.ab631a42.png"},7761:function(s,t,n){s.exports=n.p+"assets/img/1646211768532.da15823d.png"},7762:function(s,t,n){s.exports=n.p+"assets/img/1646211976007.b6005675.png"},9879:function(s,t,n){"use strict";n.r(t);var a=n(5),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_8-k8s集群搭建-所有机器预备环境准备完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-k8s集群搭建-所有机器预备环境准备完成"}},[s._v("#")]),s._v(" 8.k8s集群搭建-所有机器预备环境准备完成")]),s._v(" "),a("p",[s._v("​\t了解：一些文章说k8s要放弃docker了吗，我们为什么还要安装及学习docker，这个我们就直接下结论吧，因为docker是提供容器化环境的，k8s需要容器化的环境，以前是k8s为了适配docker写了很多代码，现在k8s希望docker能适配他自己，然后docker一定不会放弃这个大的市场，docker一定会做与k8s兼容的适配的，这样以后就不需要k8s过多的操心了。docker肯定是不会被抛弃的。")]),s._v(" "),a("h2",{attrs:{id:"_1-安装工具类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装工具类"}},[s._v("#")]),s._v(" 1.安装工具类")]),s._v(" "),a("p",[s._v("​\t每台机器都安装好docker容器后，就需要安装一些集群的工具了")]),s._v(" "),a("p",[a("img",{attrs:{src:n(7759),alt:"1646208945259"}})]),s._v(" "),a("p",[s._v("​\t就是这三个工具--kubeadm、kubectl、kubelet，把这三个工具安装完成后，集群搭建就容易多了")]),s._v(" "),a("p",[a("strong",[s._v("安装有个要求：")])]),s._v(" "),a("p",[s._v("​\t1.就是所有的Linux主机系统版本，都是常规Linux的发行版本，因为要通用的指令。")]),s._v(" "),a("p",[s._v("​\t2.机器的内存必须是大于2G内存的。")]),s._v(" "),a("p",[s._v("​\t3.机器需要2核CPU或者更多")]),s._v(" "),a("p",[s._v("​\t4.集群中的所有机器网络必须是互通的--比如VPC网络组内互信")]),s._v(" "),a("p",[s._v("​\t\t\t设置防火墙放行规则")]),s._v(" "),a("p",[s._v("​\t5.节点之中不可以有重复的主机名、MAC 地址或 product_uuid。请参见"),a("a",{attrs:{href:"https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#verify-mac-address",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v("了解更多详细信息。如root@***各个主机都不重复")]),s._v(" "),a("p",[s._v("​\t\t\t设置不同的hostname 起个好理解的名字")]),s._v(" "),a("p",[a("img",{attrs:{src:n(7760),alt:"1646211586055"}})]),s._v(" "),a("p",[s._v("​\t6.开启机器上的某些端口。请参见"),a("a",{attrs:{href:"https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#check-required-ports",target:"_blank",rel:"noopener noreferrer"}},[s._v("这里"),a("OutboundLink")],1),s._v(" 了解更多详细信息。")]),s._v(" "),a("p",[s._v("​\t\t\t"),a("strong",[s._v("内网互信")])]),s._v(" "),a("p",[s._v("​\t7.禁用交换分区，为了保证kubelet正常工作，你必须禁用交换分区。")]),s._v(" "),a("p",[s._v("​\t\t\t"),a("strong",[s._v("永久关闭")])]),s._v(" "),a("p",[s._v("​\t\t"),a("strong",[s._v("什么是交换分区")]),s._v("free -m查看 SWap 必须都是0 0 0")]),s._v(" "),a("p",[a("img",{attrs:{src:n(7761),alt:"1646211768532"}})]),s._v(" "),a("p",[s._v("​\t关闭SWap分区")]),s._v(" "),a("p",[a("img",{attrs:{src:n(7762),alt:"1646211976007"}})]),s._v(" "),a("p",[s._v("​")]),s._v(" "),a("h2",{attrs:{id:"_2-基础环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-基础环境"}},[s._v("#")]),s._v(" 2.基础环境")]),s._v(" "),a("p",[s._v("所有机器执行以下操作")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#各个机器设置自己的域名")]),s._v("\nhostnamectl set-hostname xxxx\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 SELinux 设置为 permissive 模式（相当于将其禁用）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" setenforce "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^SELINUX=enforcing$/SELINUX=permissive/'")]),s._v(" /etc/selinux/config\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关闭swap")]),s._v("\nswapoff -a  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许 iptables 检查桥接流量，因为可能有一些IPV6的流量桥接到IPV4上面，统计方便，统计的数值也精确，这是k8s官方让要求我们做的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/modules-load.d/k8s.conf")]),s._v("\nbr_netfilter\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/sysctl.d/k8s.conf")]),s._v("\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让以上配置生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" sysctl --system\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("那么 以上我们系统中整体配置都生效后，我们的预备环境就准备完成了。。。")]),s._v(" "),a("p",[s._v("课程的第33节结束https://www.bilibili.com/video/BV13Q4y1C7hS?p=33&spm_id_from=333.880.my_history.page.click")]),s._v(" "),a("h3",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")])])])}),[],!1,null,null,null);t.default=e.exports}}]);