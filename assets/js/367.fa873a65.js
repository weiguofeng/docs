(window.webpackJsonp=window.webpackJsonp||[]).push([[367],{6760:function(s,t,a){s.exports=a.p+"assets/img/1651139810501.34d25ac7.png"},6761:function(s,t,a){s.exports=a.p+"assets/img/1651140019283.d2d3bd31.png"},6762:function(s,t,a){s.exports=a.p+"assets/img/1651140302324.3f3fc366.png"},6763:function(s,t,a){s.exports=a.p+"assets/img/1651140344150.6a70502c.png"},6764:function(s,t,a){s.exports=a.p+"assets/img/1651140370083.b684a98e.png"},6765:function(s,t,a){s.exports=a.p+"assets/img/1651140518336.5b7e5ff3.png"},6766:function(s,t,a){s.exports=a.p+"assets/img/1651140587835.f5664df0.png"},6767:function(s,t,a){s.exports=a.p+"assets/img/1651140777726.51ea33ba.png"},8876:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_35-k8s核心实战-服务网络-ingress高级-限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_35-k8s核心实战-服务网络-ingress高级-限流"}},[s._v("#")]),s._v(" 35.k8s核心实战-服务网络-Ingress高级-限流")]),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("​\t\t我们了解一下Ingress的流量限流")]),s._v(" "),n("p",[s._v("​\t\t我们再来映射一个haha.atguigu.com")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6760),alt:"1651139810501"}})]),s._v(" "),n("p",[s._v("​\t\t我们的这个请求还是映射到nginx，但是我们想让这个请求-做一个流量的流速限制，相当于每秒我们放进去一个请求进来")]),s._v(" "),n("p",[s._v("​\t我们可以参考一下官方文档--看一下如果我们需要加入限流需要加入什么参数")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6761),alt:"1651140019283"}})]),s._v(" "),n("p",[s._v("​\tIngress加入限流规则的yaml")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("limit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rate\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx.ingress.kubernetes.io/limit-rps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ingressClassName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"haha.atguigu.com"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Exact\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("ul",[n("li",[s._v("pathType: Exact 是精确模式")])]),s._v(" "),n("p",[s._v("​\t限流起作用的参数就是，限制每秒1个请求")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v('annotations:\n\tnginx.ingress.kubernetes.io/limit-rps: "1"\n')])])]),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("我们应用一下这个配置文件")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6762),alt:"1651140302324"}})]),s._v(" "),n("p",[s._v("我们看一下这个Ingress规则")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6763),alt:"1651140344150"}})]),s._v(" "),n("p",[s._v("没有问题--可以响应")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6764),alt:"1651140370083"}})]),s._v(" "),n("p",[s._v("​\t我们加快访问的速度-疯狂刷新一下页面--发现偶尔会报503")]),s._v(" "),n("p",[s._v("​\t503是服务不可用")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6765),alt:"1651140518336"}})]),s._v(" "),n("p",[s._v("​\t为什么是503呢--我们的文档提示，如果我们限流的流量太大的时候我们就给她返回503状态")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6766),alt:"1651140587835"}})]),s._v(" "),n("p",[s._v("​\t如果想修改这个状态码--点击limit-req-status-code--会进入到nginx文档，需要配置的就是nginx的内容了")]),s._v(" "),n("p",[n("img",{attrs:{src:a(6767),alt:"1651140777726"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);