(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{2138:function(t,s,p){t.exports=p.p+"assets/img/1639482843925.7e94fc93.png"},2139:function(t,s,p){t.exports=p.p+"assets/img/1639483600774.956da7f1.png"},2140:function(t,s,p){t.exports=p.p+"assets/img/1639483779411.d54344b4.png"},2141:function(t,s,p){t.exports=p.p+"assets/img/1639483894049.ca6d264f.png"},2142:function(t,s,p){t.exports=p.p+"assets/img/1639483931811.5b07330b.png"},2143:function(t,s,p){t.exports=p.p+"assets/img/1639484172764.1a54efc1.png"},2144:function(t,s,p){t.exports=p.p+"assets/img/1639484184826.a80bfa42.png"},2145:function(t,s,p){t.exports=p.p+"assets/img/1639484224588.8b98e647.png"},2146:function(t,s,p){t.exports=p.p+"assets/img/1639484366799.1dc1324a.png"},2147:function(t,s,p){t.exports=p.p+"assets/img/1639484469468.ffe79174.png"},2148:function(t,s,p){t.exports=p.p+"assets/img/1639484501616.aded1af5.png"},2149:function(t,s,p){t.exports=p.p+"assets/img/1639484575408.584c7d66.png"},2150:function(t,s,p){t.exports=p.p+"assets/img/1639485500497.a2c71b63.png"},2151:function(t,s,p){t.exports=p.p+"assets/img/1639484699832.dd5f4f32.png"},2152:function(t,s,p){t.exports=p.p+"assets/img/1639485892198.51339966.png"},2153:function(t,s,p){t.exports=p.p+"assets/img/1639486106406.ad7cd0da.png"},2154:function(t,s,p){t.exports=p.p+"assets/img/1639486124081.5ac5a1e9.png"},2155:function(t,s,p){t.exports=p.p+"assets/img/1639486253982.22419507.png"},2156:function(t,s,p){t.exports=p.p+"assets/img/1639486317546.c72c4ad4.png"},2157:function(t,s,p){t.exports=p.p+"assets/img/1639486639035.26aea15d.png"},2158:function(t,s,p){t.exports=p.p+"assets/img/1639486755848.69c757d5.png"},2159:function(t,s,p){t.exports=p.p+"assets/img/1639486823595.93504e91.png"},2160:function(t,s,p){t.exports=p.p+"assets/img/1639486864135.b01674fb.png"},2161:function(t,s,p){t.exports=p.p+"assets/img/1639486960294.2cc11a13.png"},2162:function(t,s,p){t.exports=p.p+"assets/img/1639487012575.a8865388.png"},2163:function(t,s,p){t.exports=p.p+"assets/img/1639487088848.392f9a40.png"},2164:function(t,s,p){t.exports=p.p+"assets/img/1639487411533.d0897b31.png"},2165:function(t,s,p){t.exports=p.p+"assets/img/1639487458794.89467a31.png"},2166:function(t,s,p){t.exports=p.p+"assets/img/1639487534129.448ae397.png"},2167:function(t,s,p){t.exports=p.p+"assets/img/1639487589156.0d47b995.png"},2168:function(t,s,p){t.exports=p.p+"assets/img/1639487627451.ca123dbc.png"},2169:function(t,s,p){t.exports=p.p+"assets/img/1639487726518.f8688d69.png"},2170:function(t,s,p){t.exports=p.p+"assets/img/1639488023546.d829d357.png"},2171:function(t,s,p){t.exports=p.p+"assets/img/1639488167760.40f7b353.png"},2172:function(t,s,p){t.exports=p.p+"assets/img/1639489257656.13d61bd9.png"},2173:function(t,s,p){t.exports=p.p+"assets/img/1639488410687.d52fae33.png"},2174:function(t,s,p){t.exports=p.p+"assets/img/1639488839966.e24ba3b7.png"},2175:function(t,s,p){t.exports=p.p+"assets/img/1639489066546.664ec894.png"},2176:function(t,s,p){t.exports=p.p+"assets/img/1639489148858.8561b23f.png"},2177:function(t,s,p){t.exports=p.p+"assets/img/1639489331113.40c9c22c.png"},2178:function(t,s,p){t.exports=p.p+"assets/img/1639489394878.c8169c65.png"},2179:function(t,s,p){t.exports=p.p+"assets/img/1639489507702.bd7f534a.png"},2180:function(t,s,p){t.exports=p.p+"assets/img/1639489575478.e9d040a3.png"},2181:function(t,s,p){t.exports=p.p+"assets/img/1639489643982.e9cdf4c4.png"},8627:function(t,s,p){"use strict";p.r(s);var a=p(5),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_24-用户列表-添加用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_24-用户列表-添加用户"}},[t._v("#")]),t._v(" 24.用户列表-添加用户")]),t._v(" "),a("p",[t._v("​\t我们现在需要收集用户表单内的信息，然后提交给后台进行保存或者是修改操作")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2138),alt:"1639482843925"}})]),t._v(" "),a("p",[t._v("我们先将Form单独做一个组件--封装一下，因为这样结构更清晰一些")]),t._v(" "),a("p",[t._v("​\t我们新建一个user_manager用户管理的文件夹---然后在下面在建一个UserForm.js组件用来放Form组件的")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2139),alt:"1639483600774"}})]),t._v(" "),a("p",[t._v("我们在使用UserForm组件的时候--把他需要的值以属性的方式传入进去")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2140),alt:"1639483779411"}})]),t._v(" "),a("p",[t._v("在UserForm组件中，获取传入过来的值---父子传值，子用形参 props接就可以了")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2141),alt:"1639483894049"}})]),t._v(" "),a("p",[t._v("然后props.传入的属性就可以获取到数据了")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2142),alt:"1639483931811"}})]),t._v(" "),a("p",[t._v("我们需要改装一下组件--原因是我们为了表单传值方便 使用ref的话有点麻烦")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2143),alt:"1639484172764"}})]),t._v(" "),a("p",[a("img",{attrs:{src:p(2144),alt:"1639484184826"}})]),t._v(" "),a("p",[t._v("然后使用forwardRef包裹一下 forwardRef是一个方法，使用他会传入一个形参ref")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2145),alt:"1639484224588"}})]),t._v(" "),a("p",[t._v("我们在Form中就使用这个形参的ref，那么这个ref是从哪来的呢")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2146),alt:"1639484366799"}})]),t._v(" "),a("p",[t._v("在父组件中，引入ref")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2147),alt:"1639484469468"}})]),t._v(" "),a("p",[t._v("在父组件中，创建出ref 并设置空值")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2148),alt:"1639484501616"}})]),t._v(" "),a("p",[t._v("然后给子组件UserForm传入ref")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2149),alt:"1639484575408"}})]),t._v(" "),a("p",[t._v("我们现在测试一下，在点击确定后，打印一下表单的数据")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2150),alt:"1639485500497"}})]),t._v(" "),a("p",[t._v("​\t\t我们看到可以获取到好多form表单的方法")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2151),alt:"1639484699832"}})]),t._v(" "),a("p",[t._v("通过以上 forwordRef包裹的方式--然后就可以从父组件中获取到 子组件中的ref的内容了---这就是高阶组件的一种应用")]),t._v(" "),a("p",[t._v("现在我们可以通过addForm 就是我们获取到的ref 他的 current.validatefields来获取到表单的内容了---代表我们成功收集到了表单数据--如果收集失败走catch 打印失败原因")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2152),alt:"1639485892198"}})]),t._v(" "),a("p",[t._v("页面查看发现 报错：原因是没有加括号的问题")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2153),alt:"1639486106406"}})]),t._v(" "),a("p",[t._v("加上方法的括号---这个方法validateFields其实就是先走校验，校验成功后走then这个方法，校验失败走catch")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2154),alt:"1639486124081"}})]),t._v(" "),a("p",[t._v("页面查看效果：因为没有通过校验--所以走catch 报错提示")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2155),alt:"1639486253982"}})]),t._v(" "),a("p",[t._v("我们输入内容后--点击确定，我们可以看到 收集到的数据是没有问题的")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2156),alt:"1639486317546"}})]),t._v(" "),a("h4",{attrs:{id:"_2、数据做优化处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、数据做优化处理"}},[t._v("#")]),t._v(" 2、数据做优化处理")]),t._v(" "),a("p",[t._v("​")]),t._v(" "),a("p",[t._v("现在我们有个问题--就是角色如果是超级管理员的时候--其实是不需要区域进行选则的")]),t._v(" "),a("p",[t._v("思路是：每次我们在选择角色的时候--我们来处理区域选择 是属于禁用和非禁用状态")]),t._v(" "),a("p",[t._v("先设置一个状态值，然后给角色的下拉框 绑定一个事件来处理")]),t._v(" "),a("p",[t._v("​\t\t定义isDisabled 默认是 false")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2157),alt:"1639486639035"}})]),t._v(" "),a("p",[t._v("然后把这个值 放在区域的select属性中，控制区域的选择是否禁用")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2158),alt:"1639486755848"}})]),t._v(" "),a("p",[t._v("我们给角色添加一个onChange事件---然后获取当前的value值")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2159),alt:"1639486823595"}})]),t._v(" "),a("p",[t._v("查看一下获取到的change的value值")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2160),alt:"1639486864135"}})]),t._v(" "),a("p",[t._v("添加判断--控制禁用")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2161),alt:"1639486960294"}})]),t._v(" "),a("p",[t._v("页面查看效果：我们点击超级管理员后，发现区域变成禁用了")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2162),alt:"1639487012575"}})]),t._v(" "),a("p",[t._v("如果是先选区域，后选角色的话--发现区域虽然禁用了，但内容还是在的")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2163),alt:"1639487088848"}})]),t._v(" "),a("p",[t._v("我们还需要对禁用的 value 做一个清空的处理")]),t._v(" "),a("p",[t._v("如何设置表单内容的值呢---使用ref的setFieldsValue这个函数，需要传入一个对象，JSON格式")]),t._v(" "),a("p",[t._v("比如我们现在只想修改区域 region   那就是 { region ：“” } 设置region为空")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2164),alt:"1639487411533"}})]),t._v(" "),a("p",[t._v("注意这个Region就是我们表单中的name属性值")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2165),alt:"1639487458794"}})]),t._v(" "),a("p",[t._v("注意是ref.current下使用这个方法，否则报错")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2166),alt:"1639487534129"}})]),t._v(" "),a("p",[t._v("测试一下效果：")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2167),alt:"1639487589156"}})]),t._v(" "),a("p",[t._v("发现数据是可以被清空的--没有问题")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2168),alt:"1639487627451"}})]),t._v(" "),a("p",[t._v("现在又有一个问题--就是我们之前校验的规则是区域不能为空--现在我们使用超级管理员设置为空之后，导致校验无法通过了")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2169),alt:"1639487726518"}})]),t._v(" "),a("p",[t._v("解决思路是：要么就是不要设置空值，设置全球的区域权限，要么就是区域不要设置为必填项，要么就是改变规则")]),t._v(" "),a("p",[t._v("我们选择的是重新设置校验规则")]),t._v(" "),a("p",[t._v("​\t如果是禁用状态就设置rules为空数组相当于没有任何校验控制，如果不是禁用的时候 就是required必填的规则")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2170),alt:"1639488023546"}})]),t._v(" "),a("p",[t._v("页面查看效果：没有问题，选择超级管理员后 区域禁用而且必填的*号也消失了，表单收集的数据也得到了，说明校验规则也通过了")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2171),alt:"1639488167760"}})]),t._v(" "),a("h4",{attrs:{id:"_3、处理表单数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、处理表单数据"}},[t._v("#")]),t._v(" 3、处理表单数据")]),t._v(" "),a("p",[t._v("我们将点击确定的ok函数中，把里面的逻辑进行抽离 从新定义一个addFormOk函数")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2172),alt:"1639489257656"}})]),t._v(" "),a("p",[a("img",{attrs:{src:p(2173),alt:"1639488410687"}})]),t._v(" "),a("p",[t._v("然后就是让模态框消失---然后就是展开现有的table数据，将新加的给添加上去")]),t._v(" "),a("p",[t._v("​\t\t有个特殊的点：如果现在加上去也没有问题，但是如果后期要删除的时候发现有问题了，原因了没有id如何删除，所以我们现在需要解决的问题是 如何将id也给加上")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2174),alt:"1639488839966"}})]),t._v(" "),a("p",[t._v("那么就应该先post到后端，生成id后，再设置dataSource的值，方便后面的修改和删除操作")]),t._v(" "),a("p",[t._v("​\t我们将有的数据直接 ...value展开就可以设置了，没有的属性我们再设置一下")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2175),alt:"1639489066546"}})]),t._v(" "),a("p",[t._v("而在我们成功插入数据后--后端给我们返回的数据，应该是会返回插入数据当前的id值的")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2176),alt:"1639489148858"}})]),t._v(" "),a("p",[t._v("页面测试：成功的回调回来了---获取到了对象的全部属性 当然id也可以获取的到")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2177),alt:"1639489331113"}})]),t._v(" "),a("p",[t._v("JSONServer中也查看插入没有问题")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2178),alt:"1639489394878"}})]),t._v(" "),a("p",[t._v("现在我们就可以setState的，把之前的数据展开，然后将最新的数据放入进去")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2179),alt:"1639489507702"}})]),t._v(" "),a("p",[t._v("页面进行测试：")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2180),alt:"1639489575478"}})]),t._v(" "),a("p",[t._v("测试完成--发现是好使的--添加成功没有问题")]),t._v(" "),a("p",[a("img",{attrs:{src:p(2181),alt:"1639489643982"}})]),t._v(" "),a("p",[t._v("视频地址：")]),t._v(" "),a("p",[t._v("https://www.bilibili.com/video/BV13v411H74b?p=25")])])}),[],!1,null,null,null);s.default=r.exports}}]);