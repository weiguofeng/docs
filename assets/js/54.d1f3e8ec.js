(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{3899:function(t,a,s){t.exports=s.p+"assets/img/image-20211230224541712.cd2d9cbe.png"},3900:function(t,a,s){t.exports=s.p+"assets/img/image-20211230224637268.452b06bb.png"},3901:function(t,a,s){t.exports=s.p+"assets/img/image-20211230224944750.28b35066.png"},3902:function(t,a,s){t.exports=s.p+"assets/img/image-20211230225313601.1bccb5ee.png"},3903:function(t,a,s){t.exports=s.p+"assets/img/image-20211230225415784.4faa0e8c.png"},3904:function(t,a,s){t.exports=s.p+"assets/img/image-20211230225525247.50010985.png"},3905:function(t,a,s){t.exports=s.p+"assets/img/image-20211230225709138.c879bb09.png"},3906:function(t,a,s){t.exports=s.p+"assets/img/image-20211230230209283.d567c62e.png"},3907:function(t,a,s){t.exports=s.p+"assets/img/image-20211230230729769.a3dc2b21.png"},3908:function(t,a,s){t.exports=s.p+"assets/img/image-20211230231238521.92422f8f.png"},3909:function(t,a,s){t.exports=s.p+"assets/img/image-20211230231800285.0ccc02ba.png"},3910:function(t,a,s){t.exports=s.p+"assets/img/image-20211230231841447.a5801a14.png"},3911:function(t,a,s){t.exports=s.p+"assets/img/image-20211230231912996.d1c80735.png"},3912:function(t,a,s){t.exports=s.p+"assets/img/image-20211230232608419.9e70f77b.png"},3913:function(t,a,s){t.exports=s.p+"assets/img/image-20211230232647715.07a51a3e.png"},3914:function(t,a,s){t.exports=s.p+"assets/img/image-20211230232940195.b0261a9a.png"},3915:function(t,a,s){t.exports=s.p+"assets/img/image-20211230233158725.6e72ba6c.png"},3916:function(t,a,s){t.exports=s.p+"assets/img/image-20211230233506967.29389e64.png"},3917:function(t,a,s){t.exports=s.p+"assets/img/image-20211230233645390.03e63f3f.png"},3918:function(t,a,s){t.exports=s.p+"assets/img/image-20211230233726841.64770cc3.png"},3919:function(t,a,s){t.exports=s.p+"assets/img/image-20211230233928988.0f3399ad.png"},3920:function(t,a,s){t.exports=s.p+"assets/img/image-20211230234006497.a8a62862.png"},3921:function(t,a,s){t.exports=s.p+"assets/img/image-20211230234108601.948fb684.png"},3922:function(t,a,s){t.exports=s.p+"assets/img/image-20211230234127936.f439e6d6.png"},3923:function(t,a,s){t.exports=s.p+"assets/img/image-20211230234222956.f8ae255d.png"},3924:function(t,a,s){t.exports=s.p+"assets/img/image-20211230234559332.e90011a7.png"},3925:function(t,a,s){t.exports=s.p+"assets/img/image-20211230234441622.bb5e444f.png"},8557:function(t,a,s){"use strict";s.r(a);var i=s(5),e=Object(i.a)({},(function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("h1",{attrs:{id:"_21-gitlab-基本运维-备份恢复"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_21-gitlab-基本运维-备份恢复"}},[t._v("#")]),t._v(" 21.gitLab-基本运维-备份恢复")]),t._v(" "),i("h4",{attrs:{id:"_1、gitlab如何进行备份"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_1、gitlab如何进行备份"}},[t._v("#")]),t._v(" 1、gitLab如何进行备份")]),t._v(" "),i("p",[t._v("​\t我们先查看一下默认的备份路径--》到gitLab.rb文件中查看")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3899),alt:"image-20211230224541712"}})]),t._v(" "),i("p",[t._v("​\t默认是开启备份的--并且备份是在 backups文件夹下")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3900),alt:"image-20211230224637268"}})]),t._v(" "),i("p",[t._v("​\t由于var 这个目录可能磁盘的空间并没有那么的大，我们一般有个data的目录下面挂一个大的磁盘，这样的话data更适合做备份文件夹")]),t._v(" "),i("h4",{attrs:{id:"_2、设置备份"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置备份"}},[t._v("#")]),t._v(" 2、设置备份")]),t._v(" "),i("p",[t._v("​\t我们创建一个备份的文件夹--这个文件目录必须要足够大的空间--也就是说挂大磁盘")]),t._v(" "),i("p",[t._v("​\t如果不够大就没有配置的必要了--使用默认就可以了")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3901),alt:"image-20211230224944750"}})]),t._v(" "),i("p",[t._v("​")]),t._v(" "),i("p",[t._v("​\t开启备份和调整备份路径")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3902),alt:"image-20211230225313601"}})]),t._v(" "),i("p",[t._v("​\t设置keepTime 备份时间--默认是7天备份一次")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3903),alt:"image-20211230225415784"}})]),t._v(" "),i("p",[t._v("​\t修改完配置文件--需要初始配置--让配置生效")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3904),alt:"image-20211230225525247"}})]),t._v(" "),i("p",[t._v("​\t如果不想这样配置-想手动备份一次的话--使用gitLab-rake gitlab：backup:create 命令备份")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3905),alt:"image-20211230225709138"}})]),t._v(" "),i("p",[t._v("​\t注意：这个备份是备份的gitlab仓库的内容，也就是一些项目等配置，并不是备份的gitlab")]),t._v(" "),i("p",[t._v("​\t备份完成--生成的文件是时间戳+backup 的tar包")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3906),alt:"image-20211230230209283"}})]),t._v(" "),i("p",[t._v("​\t如果我们想每天备份一次呢--使用corn")]),t._v(" "),i("p",[t._v("​\t\t使用命令crontab -l      这个是设置定时任务")]),t._v(" "),i("p",[t._v("​\t\t&>是输出的意思 输出的内容就是  /dev/null 输出个空")]),t._v(" "),i("p",[t._v("​\t\t《*   *   *   *   * 》 （五个* 代表 分 时 日 月 周）")]),t._v(" "),i("p",[t._v("​\t这个就是设置为每天2点 0分 执行备份")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3907),alt:"image-20211230230729769"}})]),t._v(" "),i("h4",{attrs:{id:"_3、恢复备份"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_3、恢复备份"}},[t._v("#")]),t._v(" 3、恢复备份")]),t._v(" "),i("p",[t._v("​\t我们不小心把项目删除掉了，现在想恢复")]),t._v(" "),i("p",[t._v("​\t控制中心--》设置--》通用--》高级")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3908),alt:"image-20211230231238521"}})]),t._v(" "),i("p",[t._v("​")]),t._v(" "),i("p",[t._v("​\t\t在高级的最下面")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3909),alt:"image-20211230231800285"}})]),t._v(" "),i("p",[t._v("​\t删除项目：")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3910),alt:"image-20211230231841447"}})]),t._v(" "),i("p",[t._v("​")]),t._v(" "),i("p",[t._v("​\t确认删除：\t\t然后项目就没有了")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3911),alt:"image-20211230231912996"}})]),t._v(" "),i("p",[t._v("​\t现在我们想要恢复--这个项目")]),t._v(" "),i("h5",{attrs:{id:"_3-1-先要停止gitlab服务或者是停止数据写入服务"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-先要停止gitlab服务或者是停止数据写入服务"}},[t._v("#")]),t._v(" 3.1 先要停止gitLab服务或者是停止数据写入服务")]),t._v(" "),i("p",[t._v("​\t\t我们使用停止数据写入服务")]),t._v(" "),i("div",{staticClass:"language- line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[t._v("gitlab-ctl stop unicron\ngitlab-vtl stop sidekiq\n")])]),t._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[t._v("1")]),i("br"),i("span",{staticClass:"line-number"},[t._v("2")]),i("br")])]),i("h5",{attrs:{id:"_3-2-开始恢复项目"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-开始恢复项目"}},[t._v("#")]),t._v(" 3.2 开始恢复项目")]),t._v(" "),i("p",[t._v("​\t查看备份文件名称 copy名称")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3912),alt:"image-20211230232608419"}})]),t._v(" "),i("p",[t._v("​\t使用命令进行恢复  --注意：不需要.tar")]),t._v(" "),i("div",{staticClass:"language- line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[t._v("gitlab-rake gitlab：backup：restore BACKUP= 备份文件名称\n")])]),t._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[t._v("1")]),i("br")])]),i("p",[i("img",{attrs:{src:s(3913),alt:"image-20211230232647715"}})]),t._v(" "),i("p",[t._v("提示我们这个文件不存在--原因是文件名称只要时间戳的那些"),i("img",{attrs:{src:s(3914),alt:"image-20211230232940195"}})]),t._v(" "),i("p",[t._v("​\t现在我们使用前面的时间戳就可以了")]),t._v(" "),i("p",[t._v("​\t然后提示：开始恢复数据前-我们会删除现有的数据表-以免后期升级带来故障-是否删除yes就可以了")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3915),alt:"image-20211230233158725"}})]),t._v(" "),i("p",[t._v("​")]),t._v(" "),i("p",[t._v("​\t然后又提示：继续yes--这个应该是恢复认证的keys文件")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3916),alt:"image-20211230233506967"}})]),t._v(" "),i("p",[t._v("​\t然后提示恢复结束--")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3917),alt:"image-20211230233645390"}})]),t._v(" "),i("p",[t._v("​\t现在我们重启gitlab")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3918),alt:"image-20211230233726841"}})]),t._v(" "),i("p",[t._v("​\t我们可以查看一下gitlab的日志有没有启动完成")]),t._v(" "),i("p",[t._v("​\tgitlab-ctl tail")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3919),alt:"image-20211230233928988"}})]),t._v(" "),i("p",[i("img",{attrs:{src:s(3920),alt:"image-20211230234006497"}})]),t._v(" "),i("p",[t._v("​\t我们看到master 主程序启动成功了")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3921),alt:"image-20211230234108601"}})]),t._v(" "),i("p",[t._v("​\t这是之前没有启动起来的服务502问题")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3922),alt:"image-20211230234127936"}})]),t._v(" "),i("p",[t._v("​\t现在我们刷新页面： 页面正常--项目也恢复 了")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3923),alt:"image-20211230234222956"}})]),t._v(" "),i("h4",{attrs:{id:"_4、如果是升级gitlab如何升级呢"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_4、如果是升级gitlab如何升级呢"}},[t._v("#")]),t._v(" 4、如果是升级gitlab如何升级呢")]),t._v(" "),i("p",[t._v("​\t\t先备份数据--")]),t._v(" "),i("p",[t._v("​\twww.xuliangwei.com/bgx/803.html")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3924),alt:"image-20211230234559332"}})]),t._v(" "),i("h4",{attrs:{id:"_5、gitlab迁移"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#_5、gitlab迁移"}},[t._v("#")]),t._v(" 5、gitlab迁移")]),t._v(" "),i("p",[i("img",{attrs:{src:s(3925),alt:"image-20211230234441622"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);