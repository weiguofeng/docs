(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{6394:function(t,s,p){t.exports=p.p+"assets/img/1657097202949.72ebd73c.png"},6395:function(t,s,p){t.exports=p.p+"assets/img/1657097415440.8a091bf5.png"},6396:function(t,s,p){t.exports=p.p+"assets/img/1657097768891.d2e44a1d.png"},6397:function(t,s,p){t.exports=p.p+"assets/img/1657097846134.e5787d52.png"},6398:function(t,s,p){t.exports=p.p+"assets/img/1657098268275.a63a27b8.png"},6399:function(t,s,p){t.exports=p.p+"assets/img/1657099312663.e58e95c0.png"},6400:function(t,s,p){t.exports=p.p+"assets/img/1657099372765.ea481c60.png"},6401:function(t,s,p){t.exports=p.p+"assets/img/1657099553823.2d1604e8.png"},6402:function(t,s,p){t.exports=p.p+"assets/img/1657099947675.b079c3e2.png"},6403:function(t,s,p){t.exports=p.p+"assets/img/1657100056835.f0b6a723.png"},6404:function(t,s,p){t.exports=p.p+"assets/img/1657100257694.a58c91a7.png"},6405:function(t,s,p){t.exports=p.p+"assets/img/1657100390828.7430d215.png"},6406:function(t,s,p){t.exports=p.p+"assets/img/1657100514696.b08c8b0c.png"},6407:function(t,s,p){t.exports=p.p+"assets/img/1657100649538.b4d0ce60.png"},6408:function(t,s,p){t.exports=p.p+"assets/img/1657100917679.ce1c6733.png"},6409:function(t,s,p){t.exports=p.p+"assets/img/1657100985509.29d13102.png"},6410:function(t,s,p){t.exports=p.p+"assets/img/1657101089424.95bd899c.png"},6411:function(t,s,p){t.exports=p.p+"assets/img/1657101156373.16b486db.png"},6412:function(t,s,p){t.exports=p.p+"assets/img/1657101195166.9b75bf8b.png"},6413:function(t,s,p){t.exports=p.p+"assets/img/1657101286436.0e0c0d45.png"},6414:function(t,s,p){t.exports=p.p+"assets/img/1657101321489.5d964219.png"},6415:function(t,s,p){t.exports=p.p+"assets/img/1657101351583.c8aeeb66.png"},6416:function(t,s,p){t.exports=p.p+"assets/img/1657101428222.b874b5e4.png"},6417:function(t,s,p){t.exports=p.p+"assets/img/1657101461904.c2975b6a.png"},6418:function(t,s,p){t.exports=p.p+"assets/img/1657101537724.366538d3.png"},6419:function(t,s,p){t.exports=p.p+"assets/img/1657101644036.c5c0c6d8.png"},6420:function(t,s,p){t.exports=p.p+"assets/img/1657101889003.bbb1f1da.png"},9080:function(t,s,p){"use strict";p.r(s);var e=p(5),a=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_14-devops-可视化pipeline-第五步-部署到dev环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_14-devops-可视化pipeline-第五步-部署到dev环境"}},[t._v("#")]),t._v(" 14.devops-可视化Pipeline-第五步-部署到dev环境")]),t._v(" "),e("p",[t._v("​\t\t我们现在进入到流水线的第五步--我们添加部署到dev环境")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6394),alt:"1657097202949"}})]),t._v(" "),e("p",[t._v("​\t\t目前默认给的模板有--第一个是审核，第二个是部署")]),t._v(" "),e("p",[t._v("​\t这个审核相当于人工卡点，走到这步的时候，流水线暂停，当某个人点击了确认之后，流水线继续，包括这个卡点我们还可以@这个有权限的人来审核，确认要不要进行构建")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6395),alt:"1657097415440"}})]),t._v(" "),e("p",[e("img",{attrs:{src:p(6396),alt:"1657097768891"}})]),t._v(" "),e("p",[t._v("​\t我们@了devliu 那么就需要等到devliu登录到这个系统后，他确认之后才可以继续流水线工作")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6397),alt:"1657097846134"}})]),t._v(" "),e("p",[t._v("​\t\t在开发期间我们就不使用这个卡点了，在真正如果到生产环境就需要了")]),t._v(" "),e("p",[t._v("​\t\t我们现在就先把这个卡点去掉")]),t._v(" "),e("p",[t._v("​\t\t我们看到模板中的第二个步骤是，模板中携带着是 按照一些配置文件 把他部署到k8s集群，有了这个东西我们以后每个微服务想要部署到集群，需要这么来做，每个微服务中都有一个deploy文件夹里面有deploy.yml文件，这个yml其实就声明了这个应用该如何部署到k8s平台上")]),t._v(" "),e("p",[t._v("​\t\t\t在deploy.yml中，包括一些镜像也可以使用变量的方式")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6398),alt:"1657098268275"}})]),t._v(" "),e("p",[t._v("​\t这些环境变量是在jenkinsfile中")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6399),alt:"1657099312663"}})]),t._v(" "),e("p",[t._v("​\t这个模板-不仅会部署Pod还会给我们产生负载均衡网络")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6400),alt:"1657099372765"}})]),t._v(" "),e("p",[t._v("​\t\t我们未来就使用这个规则部署微服务----给每个微服务准备一个deploy.yaml---k8s的部署配置文件")]),t._v(" "),e("p",[t._v("有了这个文件后，我们就可以使用kubesphere给我们抽取过来的可视化步骤--kubernetesDeploy")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6401),alt:"1657099553823"}})]),t._v(" "),e("p",[t._v("​\t\t这个kubernetesDeploy步骤，需要传入配置文件的路径位置就能部署")]),t._v(" "),e("p",[t._v("​\t\t在底层真正运行的命令是 kubectl apply  -f ***.yaml，而要运行这个命令就需要有kubectl的权限")]),t._v(" "),e("p",[t._v("​\t\t一般在master节点是有这个命令权限的，而node节点是无法执行的，master可以执行的原因就是有.kube这个文件夹")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6402),alt:"1657099947675"}})]),t._v(" "),e("p",[t._v("​\t我们进入到.kube这个文件夹，里面有个config文件，这个文件其实就是kubectl的权限配置文件")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6403),alt:"1657100056835"}})]),t._v(" "),e("p",[t._v("​\t\t也就是说如果我们想在底层部署的话，我们也得有这个")]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​\t\t所以在我们流水线中，最重要的部署步骤 --添加或设置kubernetes的凭证")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6404),alt:"1657100257694"}})]),t._v(" "),e("p",[t._v("​\t\t我们使用新建凭证，凭证的id我们之前在jenkinsfile中的变量中有copy过来")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6405),alt:"1657100390828"}})]),t._v(" "),e("p",[t._v("​\t当他引用到这个变量的时候，这个变量在部署的时候其实就是一个授权，可以使用kubectl命令，将来我们把yaml传入就可以部署了")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6406),alt:"1657100514696"}})]),t._v(" "),e("p",[t._v("​\t文件路径是  deploy文件夹下的** 全部 文件都会读取")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6407),alt:"1657100649538"}})]),t._v(" "),e("p",[t._v("​\t\t然后我们这一个微服务的部署就配置好了，其他的微服务我们设置并行流水线就可以了")]),t._v(" "),e("p",[t._v("​\t\t\tcopy--jenkinsfile脚本文件---到本地，我们本地编辑会比较快一些")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6408),alt:"1657100917679"}})]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​\t微服务全部部署搞定")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6409),alt:"1657100985509"}})]),t._v(" "),e("p",[t._v("​\t到这里还没有完，因为在deploy.yaml中，我们使用的是私有镜像仓库，需要用户和密码")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6410),alt:"1657101089424"}})]),t._v(" "),e("p",[t._v("创建凭证：")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6411),alt:"1657101156373"}})]),t._v(" "),e("p",[e("img",{attrs:{src:p(6412),alt:"1657101195166"}})]),t._v(" "),e("p",[t._v("​\t\t在这里配置可能还不够")]),t._v(" "),e("p",[t._v("​\t我们应该在项目中配置-----配置中心--秘钥")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6413),alt:"1657101286436"}})]),t._v(" "),e("p",[e("img",{attrs:{src:p(6414),alt:"1657101321489"}})]),t._v(" "),e("p",[t._v("秘钥的类型：镜像仓库的秘钥")]),t._v(" "),e("p",[t._v("​\t"),e("img",{attrs:{src:p(6415),alt:"1657101351583"}})]),t._v(" "),e("p",[t._v("​\t填写信息--进行验证--创建")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6416),alt:"1657101428222"}})]),t._v(" "),e("p",[t._v("​\t\t秘钥创建好了，如果公司使用的不是阿里云，habar的话那么就使用habar的账号")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6417),alt:"1657101461904"}})]),t._v(" "),e("p",[t._v("​\t\t有了这个秘钥后--我们部署的时候deploy.yaml文件中使用的就是这个秘钥，然后可以获取到镜像了，然后部署镜像")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6418),alt:"1657101537724"}})]),t._v(" "),e("p",[t._v("​\t\t而且部署的deploy.yaml中每个namespace都是his，我们在可视化界面看到的每个项目都是k8s中的每个namespace")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6419),alt:"1657101644036"}})]),t._v(" "),e("p",[t._v("​\t\t对了，将我们刚刚改好的jenkinsfile---copy到kubesphere流水线中")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6420),alt:"1657101889003"}})]),t._v(" "),e("p",[t._v("​\t流水线我们运行测试一下")]),t._v(" "),e("p",[t._v("https://www.bilibili.com/video/BV13Q4y1C7hS?p=119&spm_id_from=pageDriver&vd_source=243ad3a9b323313aa1441e5dd414a4ef")])])}),[],!1,null,null,null);s.default=a.exports}}]);