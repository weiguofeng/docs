(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{4041:function(t,s,a){t.exports=a.p+"assets/img/image-20220105234542988.f76fdb98.png"},4042:function(t,s,a){t.exports=a.p+"assets/img/image-20220105234922063.445df6ef.png"},4043:function(t,s,a){t.exports=a.p+"assets/img/image-20220105235749101.50cf5341.png"},4044:function(t,s,a){t.exports=a.p+"assets/img/image-20220106000758532.dd645f71.png"},4045:function(t,s,a){t.exports=a.p+"assets/img/image-20220106001056497.c6be136a.png"},4046:function(t,s,a){t.exports=a.p+"assets/img/image-20220106001242534.98c10bb8.png"},4047:function(t,s,a){t.exports=a.p+"assets/img/image-20220106001346421.f0c53b34.png"},4048:function(t,s,a){t.exports=a.p+"assets/img/image-20220106001456668.648dc8f3.png"},4049:function(t,s,a){t.exports=a.p+"assets/img/image-20220106001557109.8d5a3407.png"},4050:function(t,s,a){t.exports=a.p+"assets/img/image-20220106001707361.cb0450d2.png"},4051:function(t,s,a){t.exports=a.p+"assets/img/image-20220106001903968.892114ef.png"},4052:function(t,s,a){t.exports=a.p+"assets/img/image-20220106002032112.aceff6f6.png"},4053:function(t,s,a){t.exports=a.p+"assets/img/image-20220106002248504.16a4b77f.png"},4054:function(t,s,a){t.exports=a.p+"assets/img/image-20220106002358836.ee3e8409.png"},4055:function(t,s,a){t.exports=a.p+"assets/img/image-20220106002428195.176bdb0a.png"},4056:function(t,s,a){t.exports=a.p+"assets/img/image-20220106002649394.244a5917.png"},4057:function(t,s,a){t.exports=a.p+"assets/img/image-20220106002751554.7fe7876e.png"},4058:function(t,s,a){t.exports=a.p+"assets/img/image-20220106002853606.386eb0c6.png"},4059:function(t,s,a){t.exports=a.p+"assets/img/image-20220106003127769.cfb60897.png"},4060:function(t,s,a){t.exports=a.p+"assets/img/image-20220106003403229.f37abe1f.png"},4061:function(t,s,a){t.exports=a.p+"assets/img/image-20220106003504716.85a048a7.png"},4062:function(t,s,a){t.exports=a.p+"assets/img/image-20220106003611755.49346fb6.png"},4063:function(t,s,a){t.exports=a.p+"assets/img/image-20220106004337474.4beaa53e.png"},4064:function(t,s,a){t.exports=a.p+"assets/img/image-20220106004424553.6a5d9fcd.png"},4065:function(t,s,a){t.exports=a.p+"assets/img/image-20220106004502869.130fa8bf.png"},4066:function(t,s,a){t.exports=a.p+"assets/img/image-20220106004604369.46cbdc97.png"},4067:function(t,s,a){t.exports=a.p+"assets/img/image-20220106004728508.58446788.png"},4068:function(t,s,a){t.exports=a.p+"assets/img/image-20220106005054656.414dafdd.png"},4069:function(t,s,a){t.exports=a.p+"assets/img/image-20220106005214070.70813b4d.png"},4070:function(t,s,a){t.exports=a.p+"assets/img/image-20220106005313129.96372cc3.png"},4071:function(t,s,a){t.exports=a.p+"assets/img/image-20220106005940659.4e977a8e.png"},4072:function(t,s,a){t.exports=a.p+"assets/img/image-20220106005905629.662690e1.png"},4073:function(t,s,a){t.exports=a.p+"assets/img/image-20220106010049433.b73f8f32.png"},9126:function(t,s,a){"use strict";a.r(s);var e=a(5),i=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_6-jenkins实现集群架构自动上线功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-jenkins实现集群架构自动上线功能"}},[t._v("#")]),t._v(" 6.Jenkins实现集群架构自动上线功能")]),t._v(" "),e("p",[t._v("​\t\t我们之前实现的手动过程还是比较繁琐的，我们现在期望是改为自动化的。")]),t._v(" "),e("h2",{attrs:{id:"_1、自动发布项目实现思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、自动发布项目实现思路"}},[t._v("#")]),t._v(" 1、自动发布项目实现思路")]),t._v(" "),e("p",[t._v("​\t1、手动搭建nginx集群架构")]),t._v(" "),e("p",[t._v("​\t2、开发者提交代码至gitlab，手动拉取代码，并推送至web服务器组")]),t._v(" "),e("p",[t._v("​\t3、将手动操作编写至shell脚本，由Jenkins调取，并推送至web服务器组")]),t._v(" "),e("p",[t._v("以上3步--前2步我们都实现了")]),t._v(" "),e("h2",{attrs:{id:"_2、编写shell脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、编写shell脚本"}},[t._v("#")]),t._v(" 2、编写shell脚本")]),t._v(" "),e("p",[t._v("​\t我们在Jenkins服务器上先创建一个文件夹，然后创建一个脚本")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4041),alt:"image-20220105234542988"}})]),t._v(" "),e("p",[t._v("写脚本--先把思路写下来")]),t._v(" "),e("p",[t._v("​\t设置时间戳")]),t._v(" "),e("p",[t._v("​\t进入Jenkins工作目录 并且&&   \\  是换行的意思")]),t._v(" "),e("p",[t._v("​\t打包 到/opt/web-时间戳.tar.gz ./* 全部")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4042),alt:"image-20220105234922063"}})]),t._v(" "),e("p",[t._v("​\t设置web_server变量以空格分隔 ，然后循环")]),t._v(" "),e("p",[t._v("​\tscp 将项目的压缩包发送到web服务器的opt目录下")]),t._v(" "),e("p",[t._v("​\t然后ssh 连接目标web服务器 创建文件夹在/code/web+时间戳")]),t._v(" "),e("p",[t._v("​\t并且解压缩web+时间戳的包-到/code/web-时间戳的这个文件夹下")]),t._v(" "),e("p",[t._v("​\t删除/code/web下的全部文件 并且")]),t._v(" "),e("p",[t._v("​\t建立软连接 ln -s 将 /code/web-时间戳的文件夹 连接到 /code/web上（为以后版本恢复修改软连接提供方便）")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4043),alt:"image-20220105235749101"}})]),t._v(" "),e("p",[t._v("将这俩块内容都改为函数--因为函数如果我们不调用就不触发")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4044),alt:"image-20220106000758532"}})]),t._v(" "),e("p",[t._v("然后我们再写一个deploy函数--有人说这样写很麻烦-其实一定要写函数脚本的，不要写裸脚本，复用的机会少，而且维护困难")]),t._v(" "),e("p",[t._v("​\t编写deploy函数触发以上的第一步和第二步函数")]),t._v(" "),e("p",[t._v("​\t然后默认触发deploy函数--编写完成--保存脚本")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4045),alt:"image-20220106001056497"}})]),t._v(" "),e("p",[t._v("添加最高权限")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4046),alt:"image-20220106001242534"}})]),t._v(" "),e("p",[t._v("查看一下脚本的路径--复制")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4047),alt:"image-20220106001346421"}})]),t._v(" "),e("h2",{attrs:{id:"_3、jenkins配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、jenkins配置"}},[t._v("#")]),t._v(" 3、Jenkins配置")]),t._v(" "),e("p",[t._v("​\t在Jenkins中进入项目点击配置")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4048),alt:"image-20220106001456668"}})]),t._v(" "),e("p",[t._v("然后我们在构建中选择执行shell")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4049),alt:"image-20220106001557109"}})]),t._v(" "),e("p",[t._v("这样的话开发就看不到我们的脚本（如果直接写在这里就完全暴露脚本内容了）--点击保存")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4050),alt:"image-20220106001707361"}})]),t._v(" "),e("p",[t._v("然后点击--立即构建")]),t._v(" "),e("p",[t._v("​\t发现报错了--查看一下原因")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4051),alt:"image-20220106001903968"}})]),t._v(" "),e("p",[t._v("原因是：因为Jenkins是由Jenkins用户启动的 他无法打开tar这个包的权限")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4052),alt:"image-20220106002032112"}})]),t._v(" "),e("p",[t._v("我们查看一下运行Jenkins的用户确认一下--确实是Jenkins用户，要么升级权限，要么换为root用户")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4053),alt:"image-20220106002248504"}})]),t._v(" "),e("p",[t._v("我们改为root用户运行")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4054),alt:"image-20220106002358836"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(4055),alt:"image-20220106002428195"}})]),t._v(" "),e("p",[t._v("重启：Jenkins")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4056),alt:"image-20220106002649394"}})]),t._v(" "),e("p",[t._v("现在我们再次构建：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4057),alt:"image-20220106002751554"}})]),t._v(" "),e("p",[t._v("进入控制台看一下：")]),t._v(" "),e("p",[t._v("​\t报错：hostname解析不了--ssh的时候出错了")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4058),alt:"image-20220106002853606"}})]),t._v(" "),e("p",[t._v("修改一下脚本不用host是不是关键词的问题，改为hosts")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4059),alt:"image-20220106003127769"}})]),t._v(" "),e("p",[t._v("不是这个原因--原因是ssh需要免密要的连接")]),t._v(" "),e("p",[t._v("现在我们建立免秘钥的ssh连接")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4060),alt:"image-20220106003403229"}})]),t._v(" "),e("p",[t._v("再建立10.0.0.8的免秘钥连接")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4061),alt:"image-20220106003504716"}})]),t._v(" "),e("p",[t._v("测试ssh连接--没有问题")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4062),alt:"image-20220106003611755"}})]),t._v(" "),e("p",[t._v("再次构建：发生报错--原因是使用变量没有加$符号")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4063),alt:"image-20220106004337474"}})]),t._v(" "),e("p",[t._v("然后再次构建： 构建成功")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4064),alt:"image-20220106004424553"}})]),t._v(" "),e("p",[t._v("查看控制台--成功")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4065),alt:"image-20220106004502869"}})]),t._v(" "),e("p",[t._v("测试一下网站--能不能打开-没有问题")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4066),alt:"image-20220106004604369"}})]),t._v(" "),e("p",[t._v("然后我们在web服务器上查看一下")]),t._v(" "),e("p",[t._v("​\t在10.0.0.7下的code文件夹下web文件夹软连接到 了 /code/web+时间戳文件夹上")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4067),alt:"image-20220106004728508"}})]),t._v(" "),e("h2",{attrs:{id:"_3、模拟修改发布"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、模拟修改发布"}},[t._v("#")]),t._v(" 3、模拟修改发布")]),t._v(" "),e("p",[t._v("​\t在gitlab上直接修改一下--提交修改")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4068),alt:"image-20220106005054656"}})]),t._v(" "),e("p",[t._v("然后点击构建")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4069),alt:"image-20220106005214070"}})]),t._v(" "),e("p",[t._v("然后我们等待构建完成--刷新页面")]),t._v(" "),e("p",[t._v("​\t发现已经改变了")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4070),alt:"image-20220106005313129"}})]),t._v(" "),e("h2",{attrs:{id:"_4、脚本的优化处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、脚本的优化处理"}},[t._v("#")]),t._v(" 4、脚本的优化处理")]),t._v(" "),e("p",[t._v("​\t我们可以使用Jenkins的变量进行脚本的优化")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4071),alt:"image-20220106005940659"}})]),t._v(" "),e("p",[t._v("​\t我们还可以将多次使用的文件夹设置为变量")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4072),alt:"image-20220106005905629"}})]),t._v(" "),e("p",[t._v("点击构建--构建成功没有问题")]),t._v(" "),e("p",[e("img",{attrs:{src:a(4073),alt:"image-20220106010049433"}})]),t._v(" "),e("p",[t._v("现在的脚本有没有什么问题？1.回退怎么办？2.使用tag方式发布")]),t._v(" "),e("p",[t._v("​\t\t如果我们以tag的方式进行发布那么回退的问题是不是也是可以解决的")])])}),[],!1,null,null,null);s.default=i.exports}}]);