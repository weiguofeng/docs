(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{2717:function(t,s,p){t.exports=p.p+"assets/img/1639652987732.18b90e75.png"},2718:function(t,s,p){t.exports=p.p+"assets/img/1639653333935.05d138d0.png"},2719:function(t,s,p){t.exports=p.p+"assets/img/1639653228270.25439e25.png"},2720:function(t,s,p){t.exports=p.p+"assets/img/1639653385796.f2c3eb51.png"},2721:function(t,s,p){t.exports=p.p+"assets/img/1639653468483.c2bfe814.png"},2722:function(t,s,p){t.exports=p.p+"assets/img/1639654714046.7c448d51.png"},2723:function(t,s,p){t.exports=p.p+"assets/img/1639654815785.e31678cf.png"},2724:function(t,s,p){t.exports=p.p+"assets/img/1639654909462.e1f6fd0f.png"},2725:function(t,s,p){t.exports=p.p+"assets/img/1639654988330.10fa817d.png"},2726:function(t,s,p){t.exports=p.p+"assets/img/1639655067586.fe5537f4.png"},2727:function(t,s,p){t.exports=p.p+"assets/img/1639655623121.7325e6a9.png"},2728:function(t,s,p){t.exports=p.p+"assets/img/1639655690092.50885444.png"},2729:function(t,s,p){t.exports=p.p+"assets/img/1639655914274.bcd7c6eb.png"},2730:function(t,s,p){t.exports=p.p+"assets/img/1639656118694.570a549a.png"},2731:function(t,s,p){t.exports=p.p+"assets/img/1639656051500.c57027af.png"},2732:function(t,s,p){t.exports=p.p+"assets/img/1639656176996.d1c2866e.png"},2733:function(t,s,p){t.exports=p.p+"assets/img/1639656386803.8bbf2143.png"},2734:function(t,s,p){t.exports=p.p+"assets/img/1639656597982.9d40fc39.png"},2735:function(t,s,p){t.exports=p.p+"assets/img/1639656631759.ed6aa394.png"},2736:function(t,s,p){t.exports=p.p+"assets/img/1639656683315.d941c78c.png"},2737:function(t,s,p){t.exports=p.p+"assets/img/1639656786954.cad0a277.png"},8666:function(t,s,p){"use strict";p.r(s);var e=p(5),a=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"登录页面-权限校验"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录页面-权限校验"}},[t._v("#")]),t._v(" .登录页面-权限校验")]),t._v(" "),e("p",[t._v("​\t我们现在在点击登录的时候--会收集到表单的提交信息")]),t._v(" "),e("p",[t._v("我们应该使用post请求，但是由于JsonServer认为你发post就是新增，所以我们暂时使用git请求的方式")]),t._v(" "),e("p",[t._v("​\t使用axios发起请求--需要校验用户-密码-开关")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2717),alt:"1639652987732"}})]),t._v(" "),e("p",[e("img",{attrs:{src:p(2718),alt:"1639653333935"}})]),t._v(" "),e("p",[t._v("登录请求给我们返回的数据--如果传入的参数都可以匹配上，返回一个对象")]),t._v(" "),e("p",[t._v("​          但是返回的没有权限--我们需要关联查询一下-根据roleId查询出roleList")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2719),alt:"1639653228270"}})]),t._v(" "),e("p",[t._v("加上关联查询条件关联role     _expand=role")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2720),alt:"1639653385796"}})]),t._v(" "),e("p",[t._v("这样就可以关联查询出来role权限集合了")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2721),alt:"1639653468483"}})]),t._v(" "),e("p",[t._v("我们判断一下---如果返回的数据是空，说明没有权限，如果不为空那么就跳转到首页")]),t._v(" "),e("p",[t._v("​\t\t我们设置一下token")]),t._v(" "),e("p",[t._v("​\t\t路由到/然后也会重定向到/home首页中")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2722),alt:"1639654714046"}})]),t._v(" "),e("p",[t._v("如果没有返回数据---我们提示一下：")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2723),alt:"1639654815785"}})]),t._v(" "),e("p",[t._v("现在我们是没有token的--在Storage中是空的")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2724),alt:"1639654909462"}})]),t._v(" "),e("p",[t._v("然后我们输入一个错误的---会提示我们错误的信息")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2725),alt:"1639654988330"}})]),t._v(" "),e("p",[t._v("我们现在输入一个正确的--然后可以跳转到首页")]),t._v(" "),e("p",[t._v("​\t\t并且我们可以看到token中有值了--现在token是一个字符串数据 object Object")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2726),alt:"1639655067586"}})]),t._v(" "),e("p",[t._v("因为这个object我们无法识别他的内容及内容中的全写，所以我们需要对这个字符串进行JSON格式化的处理")]),t._v(" "),e("p",[t._v("JSON.stringify()使用这个方法对数据进行JSON的格式化")]),t._v(" "),e("p",[t._v("​\t\t当然如果是真后端给返回的token他必然不是把用户名密码明文的暴露在这里")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2727),alt:"1639655623121"}})]),t._v(" "),e("p",[t._v("我们这次格式化之后，拿到了全部的个人信息 在token中存放--我们使用这些数据来进行对菜单的权限控制")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2728),alt:"1639655690092"}})]),t._v(" "),e("h4",{attrs:{id:"_2、设置topheader为真实数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、设置topheader为真实数据"}},[t._v("#")]),t._v(" 2、设置topHeader为真实数据")]),t._v(" "),e("p",[t._v("​\t之前一直是写死的数据--现在我们可以通过登录后进行数据的替换了")]),t._v(" "),e("p",[t._v("​\t首先我们获取到token--并且要对获取到的JSON格式的数据-进行一下解析 使用JSON.parse")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2729),alt:"1639655914274"}})]),t._v(" "),e("p",[t._v("我们结构一下需要的值：")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2730),alt:"1639656118694"}})]),t._v(" "),e("p",[t._v("设置动态的数据")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2731),alt:"1639656051500"}})]),t._v(" "),e("p",[t._v("我们用其他账号登录一下-查看效果")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2732),alt:"1639656176996"}})]),t._v(" "),e("p",[t._v("然后我们需要给他添加页面的权限")]),t._v(" "),e("p",[t._v("​\t\t之前的item.pagepermisson是校验是否显示的，我们现在加一个 当前登录用户的权限中 includes包括整个item.key这个路由的才说明有权限--才可以显示出来")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2733),alt:"1639656386803"}})]),t._v(" "),e("p",[t._v("我们获取一下当前用户的权限列表")]),t._v(" "),e("p",[t._v("我们需要的数据是rights")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2734),alt:"1639656597982"}})]),t._v(" "),e("p",[t._v("我们获取一下：从token中获取我们需要的数据，结构出角色权限列表")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2735),alt:"1639656631759"}})]),t._v(" "),e("p",[t._v("赋值")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2736),alt:"1639656683315"}})]),t._v(" "),e("p",[t._v("我们查看效果：明显页面中权限列表已经根据用户的权限来动态渲染了")]),t._v(" "),e("p",[e("img",{attrs:{src:p(2737),alt:"1639656786954"}})]),t._v(" "),e("p",[t._v("https://www.bilibili.com/video/BV13v411H74b?p=31&spm_id_from=pageDriver")])])}),[],!1,null,null,null);s.default=a.exports}}]);