(window.webpackJsonp=window.webpackJsonp||[]).push([[541],{7642:function(s,t,a){s.exports=a.p+"assets/img/1651136850953.d5531379.png"},7643:function(s,t,a){s.exports=a.p+"assets/img/1651136957226.f6f0b250.png"},7644:function(s,t,a){s.exports=a.p+"assets/img/1651137134880.422e4480.png"},7645:function(s,t,a){s.exports=a.p+"assets/img/1651137684176.1845447c.png"},7646:function(s,t,a){s.exports=a.p+"assets/img/1651137742024.a1936715.png"},9866:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_34-k8s核心实战-服务网络-ingress高级用法-路径重写"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_34-k8s核心实战-服务网络-ingress高级用法-路径重写"}},[s._v("#")]),s._v(" 34.k8s核心实战-服务网络-Ingress高级用法-路径重写")]),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("h4",{attrs:{id:"_1、使用ingress的高级用法-路径重写"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、使用ingress的高级用法-路径重写"}},[s._v("#")]),s._v(" 1、使用Ingress的高级用法--路径重写")]),s._v(" "),n("p",[s._v("​\t\t我们参照rewrite路径重写的文档看一下example案例")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7642),alt:"1651136850953"}})]),s._v(" "),n("p",[s._v("​\t\t我们只需要加一个annotation配置 $2是代表重写的地方，path:下使用了一些通配符")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7643),alt:"1651136957226"}})]),s._v(" "),n("p",[s._v("​")]),s._v(" "),n("p",[s._v("​\t\t这个配置的效果-在下面的案例也写清楚了")]),s._v(" "),n("p",[s._v("​\t\t\t就是去掉了/something")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7644),alt:"1651137134880"}})]),s._v(" "),n("p",[s._v("路径重写的配置文件： 所谓的$2 其实就是以$符分割的第二的东西就是我们需要的")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress  \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx.ingress.kubernetes.io/rewrite-target")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /$2\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bar\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ingressClassName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello.atguigu.com"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Prefix\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" hello"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demo.atguigu.com"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pathType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Prefix\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/nginx(/|$)(.*)"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把请求会转给下面的服务，下面的服务一定要能处理这个路径，不能处理就是404")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## java，比如使用路径重写，去掉前缀nginx")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("​\t\t路径重写--需要做2件事，1.需要在metadata下配置annotation，及注解信息，2设置通配的path")]),s._v(" "),n("p",[s._v("​\t现在我们修改一下Ingress的配置内容，然后应用一下")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7645),alt:"1651137684176"}})]),s._v(" "),n("p",[s._v("​\t\t\t我们请求一下带/nginx，但我们重写了路径相当于把Nginx给截取去掉了，这样就是正常访问了")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7646),alt:"1651137742024"}})]),s._v(" "),n("p",[s._v("​")])])}),[],!1,null,null,null);t.default=e.exports}}]);