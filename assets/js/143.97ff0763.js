(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{6706:function(t,s,a){t.exports=a.p+"assets/img/image-20220426213658226.85bf2ce0.png"},6707:function(t,s,a){t.exports=a.p+"assets/img/image-20220426231741143.070c5399.png"},6708:function(t,s,a){t.exports=a.p+"assets/img/image-20220426234709369.26d3006e.png"},6709:function(t,s,a){t.exports=a.p+"assets/img/image-20220426235115846.ee43b13e.png"},6710:function(t,s,a){t.exports=a.p+"assets/img/image-20220426235412335.cde39e34.png"},6711:function(t,s,a){t.exports=a.p+"assets/img/image-20220427000655291.3ecd6804.png"},6712:function(t,s,a){t.exports=a.p+"assets/img/image-20220427000834975.06833425.png"},6713:function(t,s,a){t.exports=a.p+"assets/img/image-20220427002420002.df154a70.png"},6714:function(t,s,a){t.exports=a.p+"assets/img/image-20220427002643227.8b4f562a.png"},6715:function(t,s,a){t.exports=a.p+"assets/img/image-20220427002910751.3eeb7ffb.png"},6716:function(t,s,a){t.exports=a.p+"assets/img/image-20220427002942010.be2c6be7.png"},6717:function(t,s,a){t.exports=a.p+"assets/img/image-20220427003946902.3286a790.png"},6718:function(t,s,a){t.exports=a.p+"assets/img/image-20220427004139431.c0dec83a.png"},6719:function(t,s,a){t.exports=a.p+"assets/img/image-20220427004424731.5bf7c9dd.png"},6720:function(t,s,a){t.exports=a.p+"assets/img/image-20220427004919822.76e688c8.png"},6721:function(t,s,a){t.exports=a.p+"assets/img/image-20220427005218154.13664736.png"},6722:function(t,s,a){t.exports=a.p+"assets/img/image-20220427005323185.67774c56.png"},6723:function(t,s,a){t.exports=a.p+"assets/img/image-20220427005516106.15d2d48e.png"},8871:function(t,s,a){"use strict";a.r(s);var e=a(5),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_29-k8s核心实战-服务网络-service服务发现clusterip方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_29-k8s核心实战-服务网络-service服务发现clusterip方式"}},[t._v("#")]),t._v(" 29.k8s核心实战-服务网络-Service服务发现ClusterIP方式")]),t._v(" "),e("h4",{attrs:{id:"_1-k8s的service功能及概念"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-k8s的service功能及概念"}},[t._v("#")]),t._v(" 1.k8s的Service功能及概念")]),t._v(" "),e("p",[t._v("​\t\t我们现在了解一下k8s的Service，所谓的服务是k8s用来做服务发现功能的。")]),t._v(" "),e("p",[t._v("​\t\t举个例子：假设我们现在使用deployment部署一个应用后台管理系统，我们采用前后端分离的方式进行开发的，假设我们前端使用的vue开发的，这就需要我们配置好后端的api地址，如果按照以前的方式我们配置一个IP地址他只访问一个Pod，但是如果这个Pod宕机了那么服务就无法提供了，所以我们希望这些Pod对外提供一个公共的地址。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6706),alt:"image-20220426213658226"}})]),t._v(" "),e("p",[t._v("​\t这三个Pod其实对外是一组服务，那么在k8s中这一组服务就叫Service，他是将一组Pods公开为网络服务的抽象方法。")]),t._v(" "),e("p",[t._v("​\t就像我们这个例子，我们这组Pods都是后台管理系统，Service为他们统一暴露一个地址，所以我们的前端只需要配置一个Service的IP地址就可以了，这样呢我们还需要达成的效果是当我们前端来访问Service的时候可以负载均衡的进行访问")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6707),alt:"image-20220426231741143"}})]),t._v(" "),e("p",[t._v("​\t还需要做到的是假如有一个Pod宕机了Service还可以自动发现，之后前端发起的请求就负载均衡到其他正常运行的Pod上")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6708),alt:"image-20220426234709369"}})]),t._v(" "),e("h4",{attrs:{id:"_2-测试演示service功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-测试演示service功能"}},[t._v("#")]),t._v(" 2.测试演示Service功能")]),t._v(" "),e("p",[t._v("​\t我们先来可视化界面中，这是我们之前部署的3个nginx，我们选择一个Pod进行操作一下进入容器，我们假设这就是后台管理系统，我们来到nginx的页面")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6709),alt:"image-20220426235115846"}})]),t._v(" "),e("p",[t._v("​\t我们将这个页面内容改一下比如输出1111，echo 1111 > index.html")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6710),alt:"image-20220426235412335"}})]),t._v(" "),e("p",[t._v("​\t我们第二个Pod也这么改")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6711),alt:"image-20220427000655291"}})]),t._v(" "),e("p",[t._v("第三个也一样改为3333")]),t._v(" "),e("p",[t._v("​\t我们使用curl访问一下，是没有问题的")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6712),alt:"image-20220427000834975"}})]),t._v(" "),e("p",[t._v("​\t那么我们现在想把这三个Pod配置一个公共的IP地址，怎么配呢？使用命令")]),t._v(" "),e("p",[t._v("​\tkubectl expose deploy my-dep --port=8000 --target-port=80")]),t._v(" "),e("p",[t._v("​\t\texpose 暴露-- deploy部署的名为my-dep的全部Pod")]),t._v(" "),e("p",[t._v("​\t\t重要的几个参数： --port=8000相当于这个服务将使用8000端口对外暴露")]),t._v(" "),e("p",[t._v("​\t\t\t\t\t\t\t\t\t--target-port=80这个是目标端口，相当于访问容器内部的端口")]),t._v(" "),e("p",[t._v("​\t运行完这个命令提示我们service/my-dep给我们创建了一个新的service资源")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6713),alt:"image-20220427002420002"}})]),t._v(" "),e("p",[t._v("​\t我们使用kubectl get service可以查看service资源")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6714),alt:"image-20220427002643227"}})]),t._v(" "),e("p",[t._v("​\t我们使用curl来访问这个service的IP加8000对外的端口，发现会自动为我们负载均衡的访问我们的Pod")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6715),alt:"image-20220427002910751"}})]),t._v(" "),e("p",[t._v("​\t图解：Service")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6716),alt:"image-20220427002942010"}})]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#暴露Deploy\nkubectl expose deployment my-dep --port=8000 --target-port=80\n\n#使用标签检索Pod\nkubectl get pod -l app=my-dep\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h4",{attrs:{id:"_3-配置文件的方式创建service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置文件的方式创建service"}},[t._v("#")]),t._v(" 3.配置文件的方式创建Service")]),t._v(" "),e("p",[t._v("​\t我们也可以使用yaml配置文件的方式进行配置Service")]),t._v(" "),e("p",[t._v("​\t在这个配置文件中重要的就是kind是Service功能，还有port和targetPort，更重要的是selector下的app：my-dep 是部署的名称，相当于我的这个Service是把那一组的Pod暴露出来的。")]),t._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dep\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dep\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dep\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br")])]),e("p",[t._v("每一个Pod其实在部署期间会有一个这样的东西--标签")]),t._v(" "),e("p",[t._v("kubectl get pod --show-labels")]),t._v(" "),e("p",[t._v("​\t每个pod都会有一个标签如app=my-dep，我们相当于按标签来选择同样一组Pod的")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6717),alt:"image-20220427003946902"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(6718),alt:"image-20220427004139431"}})]),t._v(" "),e("p",[t._v("​\t所以我们看到Service的优点就是可以按标签选择一组Pod，然后对外提供统一服务因为我们service会有一个固定的IP，这个IP我们注意默认也是在集群内有效--外网访问不到")]),t._v(" "),e("p",[t._v("​\t比如我们在其他集群节点机器进行访问也是没有问题的")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6719),alt:"image-20220427004424731"}})]),t._v(" "),e("p",[t._v("​\t甚至我们可以以域名的方式访问也是可以的，默认的域名是（服务名.所在名称空间.svc）")]),t._v(" "),e("p",[t._v("​\t注意这种域名的访问只能是在容器中进行的")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6720),alt:"image-20220427004919822"}})]),t._v(" "),e("p",[t._v("​\t这种Service域名如果是在机器节点中访问是不行的")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6721),alt:"image-20220427005218154"}})]),t._v(" "),e("p",[e("img",{attrs:{src:a(6722),alt:"image-20220427005323185"}})]),t._v(" "),e("p",[t._v("​\t这种模式就是Service的默认ClusterIP的类型")]),t._v(" "),e("p",[t._v("​\t我们看到这个Service的Type就是ClusterIP--称为集群IP类型")]),t._v(" "),e("p",[e("img",{attrs:{src:a(6723),alt:"image-20220427005516106"}})]),t._v(" "),e("p",[t._v("​\t也就是说我们暴露的这个IP只能在集群内部访问")]),t._v(" "),e("h4",{attrs:{id:"clusterip"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clusterip"}},[t._v("#")]),t._v(" ClusterIP")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("# 等同于没有--type的\nkubectl expose deployment my-dep --port=8000 --target-port=80 --type=ClusterIP\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dep\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dep\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dep\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIP\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br")])]),e("p",[t._v("​\t如果说我们想让大家都能访问，我们就需要使用另外一种类型叫NodePort")]),t._v(" "),e("p",[t._v("https://www.bilibili.com/video/BV13Q4y1C7hS?p=54")]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​")])])}),[],!1,null,null,null);s.default=n.exports}}]);