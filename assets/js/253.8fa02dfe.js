(window.webpackJsonp=window.webpackJsonp||[]).push([[253],{7865:function(t,s,a){t.exports=a.p+"assets/img/1655216053626.cce94d77.png"},7866:function(t,s,a){t.exports=a.p+"assets/img/1655216104524.60f45a83.png"},7867:function(t,s,a){t.exports=a.p+"assets/img/1655216489804.359e302a.png"},7868:function(t,s,a){t.exports=a.p+"assets/img/1655217119713.0f28953b.png"},7869:function(t,s,a){t.exports=a.p+"assets/img/1655217297540.c0c20e41.png"},7870:function(t,s,a){t.exports=a.p+"assets/img/1655217317778.946f83b0.png"},7871:function(t,s,a){t.exports=a.p+"assets/img/1655217370148.18b68dea.png"},7872:function(t,s,a){t.exports=a.p+"assets/img/1655217467230.ece3c3fa.png"},7873:function(t,s,a){t.exports=a.p+"assets/img/1655217511252.3a2eb4aa.png"},7874:function(t,s,a){t.exports=a.p+"assets/img/1655217547520.36337dcb.png"},7875:function(t,s,a){t.exports=a.p+"assets/img/1655217727296.545c6cd3.png"},7876:function(t,s,a){t.exports=a.p+"assets/img/1655217819285.7b2ad197.png"},7877:function(t,s,a){t.exports=a.p+"assets/img/1655218103492.3bf85b19.png"},9755:function(t,s,a){"use strict";a.r(s);var p=a(5),c=Object(p.a)({},(function(){var t=this,s=t.$createElement,p=t._self._c||s;return p("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[p("h1",{attrs:{id:"_24-kubernetes应用部署实战-ruoyi-cloud-上云部署-nacos上云分析"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#_24-kubernetes应用部署实战-ruoyi-cloud-上云部署-nacos上云分析"}},[t._v("#")]),t._v(" 24.kubernetes应用部署实战-ruoyi-cloud-上云部署-nacos上云分析")]),t._v(" "),p("p",[t._v("​\t\t\t我们之前已经完成了数据库上云的操作，接下来我们部署一个中间件Nacos。")]),t._v(" "),p("p",[t._v("​\t\t之前我们是单机部署过nacos")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7865),alt:"1655216053626"}})]),t._v(" "),p("p",[t._v("​\t那么上云呢，我们现在从官网进入 集群模式下运行Nacos")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7866),alt:"1655216104524"}})]),t._v(" "),p("p",[t._v("​\t我们看集群模式的Nacos架构图，部署多个Nacos相当于多个Pod，然后这些Pod对外暴露一个"),p("strong",[t._v("内网SLB")]),t._v("（Service-load-Balance）服务负载均衡，这种其实就是k8s的Service---相当于这个Service选中这3个Pod，然后Service统一暴露一个IP地址或域名")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7867),alt:"1655216489804"}})]),t._v(" "),p("p",[t._v("​\t我们现在集群的架构有了我们部署Nacos还应该注意什么？")]),t._v(" "),p("p",[t._v("​\t\t\t配置集群文件--需要配置cluster.conf这个文件，里面的内容就是所有的集群nacos的ip和端口都要配置进来")]),t._v(" "),p("p",[t._v("​\t\t当我们Nacos上云后，其实配置这三个nacos的ip其实是有问题的，因为我们上云后部署了3个Pod，k8s的优势是Pod的故障转移能力，假设其中一个nacos的Pod炸了，他转移到其他机器了，那么就有很大可能这个故障转移后IP地址就发生改变了，所以这个cluster-conf文件难道要经常改变吗？")]),t._v(" "),p("p",[t._v("​\t\t所以我们部署Nacos的时候我们要使用有状态的部署，这个有状态的部署起码可以保证一点，ip地址不能保证变不变但是我们的"),p("strong",[t._v("Nacos能有一个稳定的访问域名")]),t._v("，即使Pod奔溃了，故障转移到其他集群的机器上了，我们使用固定的访问域名还是可以访问的。")]),t._v(" "),p("p",[t._v("​\t\t我们未来在这个cluster-conf文件里面，写的不是IP地址而是固定域名+端口")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7868),alt:"1655217119713"}})]),t._v(" "),p("h4",{attrs:{id:"部署nacos"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#部署nacos"}},[t._v("#")]),t._v(" 部署Nacos")]),t._v(" "),p("p",[t._v("​\t我们从这个服务--里面创建")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7869),alt:"1655217297540"}})]),t._v(" "),p("p",[t._v("​\t有状态的服务")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7870),alt:"1655217317778"}})]),t._v(" "),p("p",[t._v("​\t基本信息填写")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7871),alt:"1655217370148"}})]),t._v(" "),p("p",[t._v("​\t\t选择Nacos的镜像")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7872),alt:"1655217467230"}})]),t._v(" "),p("p",[t._v("​\t指定端口8848")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7873),alt:"1655217511252"}})]),t._v(" "),p("p",[t._v("​\t同步主机时区-下一步")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7874),alt:"1655217547520"}})]),t._v(" "),p("p",[t._v("​\t因为Nacos存储在MySQL所以不需要存储卷，然后配置文件先不挂载的部署跑一下")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7875),alt:"1655217727296"}})]),t._v(" "),p("p",[t._v("​\t我们想验证一下如果起多个副本是什么样的")]),t._v(" "),p("p",[t._v("​\t\t\t新启动的副本域名也是新的，如果当前的宕机，在其他机器重新拉起一份域名是不变的")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7876),alt:"1655217819285"}})]),t._v(" "),p("p",[t._v("​\t部署分析图解")]),t._v(" "),p("p",[p("img",{attrs:{src:a(7877),alt:"1655218103492"}})]),t._v(" "),p("p",[t._v("https://www.bilibili.com/video/BV13Q4y1C7hS?p=91&spm_id_from=pageDriver")])])}),[],!1,null,null,null);s.default=c.exports}}]);