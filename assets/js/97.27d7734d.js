(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{6230:function(t,s,p){t.exports=p.p+"assets/img/1657529301286.9cf11658.png"},6231:function(t,s,p){t.exports=p.p+"assets/img/1657529497707.0c1dbb60.png"},6232:function(t,s,p){t.exports=p.p+"assets/img/1657529574188.4235663a.png"},6233:function(t,s,p){t.exports=p.p+"assets/img/1657529643184.6d0a3a78.png"},6234:function(t,s,p){t.exports=p.p+"assets/img/1657529802375.89b97d3b.png"},6235:function(t,s,p){t.exports=p.p+"assets/img/1657529849189.18be22dc.png"},6236:function(t,s,p){t.exports=p.p+"assets/img/1657529944658.2bab8112.png"},6237:function(t,s,p){t.exports=p.p+"assets/img/1657530102922.cdd7856f.png"},6238:function(t,s,p){t.exports=p.p+"assets/img/1657530298591.4c328d0e.png"},6239:function(t,s,p){t.exports=p.p+"assets/img/1657530392351.4748e42e.png"},6240:function(t,s,p){t.exports=p.p+"assets/img/1657530497753.8a77cda1.png"},6241:function(t,s,p){t.exports=p.p+"assets/img/1657530613142.4099c5d1.png"},6242:function(t,s,p){t.exports=p.p+"assets/img/1657530980997.2dc49359.png"},6243:function(t,s,p){t.exports=p.p+"assets/img/1657531199195.7eb1cc61.png"},6244:function(t,s,p){t.exports=p.p+"assets/img/1657531335479.2d7a1cc7.png"},6245:function(t,s,p){t.exports=p.p+"assets/img/1657531444210.c9b490e3.png"},6246:function(t,s,p){t.exports=p.p+"assets/img/1657531591681.6b7039b6.png"},6247:function(t,s,p){t.exports=p.p+"assets/img/1657531660326.b29a99df.png"},6248:function(t,s,p){t.exports=p.p+"assets/img/1657531784438.451ca306.png"},6249:function(t,s,p){t.exports=p.p+"assets/img/1657532655869.3323d793.png"},6250:function(t,s,p){t.exports=p.p+"assets/img/1657532845621.7fbeec2b.png"},6251:function(t,s,p){t.exports=p.p+"assets/img/1657534349422.af28ecfc.png"},8831:function(t,s,p){"use strict";p.r(s);var e=p(5),i=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"_15-devops-可视化pipeline-第五步-部署dev各种问题解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_15-devops-可视化pipeline-第五步-部署dev各种问题解决"}},[t._v("#")]),t._v(" 15.devops-可视化Pipeline-第五步-部署dev各种问题解决")]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​\t\t\t\t拉取代码---项目编译---然后构建镜像---构建完镜像---推送镜像----然后下载镜像---然后是项目部署（并发部署）")]),t._v(" "),e("p",[t._v("​\t\t我们现在是在并发部署的时候遇到了一些问题：")]),t._v(" "),e("p",[t._v("​\t\t\tCannot  find kubeconfig  这里就是我们有一个kubeconfig中有一个id找不到了")]),t._v(" "),e("p",[t._v("​\t\t\t这个其实是有的我们到jenkinsfile中寻找一下，使用idea打开jenkinsfile")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6230),alt:"1657529301286"}})]),t._v(" "),e("p",[t._v("​\t\tkubeconfig--credential-id  使用的是这个变量，是用这个变量取值的")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6231),alt:"1657529497707"}})]),t._v(" "),e("p",[t._v("​\t\t我们目前的变量定义的是  demo-kubeconfig")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6232),alt:"1657529574188"}})]),t._v(" "),e("p",[t._v("​\t\t然后我们到流水线中，寻找一个这个config文件有没有---是有的")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6233),alt:"1657529643184"}})]),t._v(" "),e("p",[t._v("​\t\t有这个值和文件--为什么会报错呢？原因是直接使用成字符串了，而我们实际上是需要动态取出这个变量的值")]),t._v(" "),e("p",[t._v("​\t\t我们需要编辑一下这个jenkinsfile的文件")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6234),alt:"1657529802375"}})]),t._v(" "),e("p",[t._v("​\t\t我们可以看到，下面的取值是使用的双引号取值，而上面有一个使用的双引号加单引号的方式取值，这里应该是不对的")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6235),alt:"1657529849189"}})]),t._v(" "),e("p",[t._v("​\t\t把这个有问题的全部替换掉--")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6236),alt:"1657529944658"}})]),t._v(" "),e("p",[t._v("​\t\t我们修改完jenkinsfile文件后，现在重新运行一下流水线")]),t._v(" "),e("p",[t._v("​\t\t这次我们看到有部署成功的了")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6237),alt:"1657530102922"}})]),t._v(" "),e("p",[t._v("​\t\t另外一个问题---应用负载中显示  都是 "),e("strong",[t._v("最小副本不可用")])]),t._v(" "),e("p",[t._v("​\t\t而最小副本不可用的原因是，我们现在先要下载镜像--这边还显示"),e("strong",[t._v("无法解析镜像名称")])]),t._v(" "),e("p",[e("img",{attrs:{src:p(6238),alt:"1657530298591"}})]),t._v(" "),e("p",[t._v("​\t我们查看一下这边镜像用的是什么---编辑配置模板")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6239),alt:"1657530392351"}})]),t._v(" "),e("p",[t._v("​\t\t他这里使用到的是阿里云的$ALIYUNHUB_NAMESPACE")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6240),alt:"1657530497753"}})]),t._v(" "),e("p",[t._v("​\t\t原因就是这个ALIYUNHUB_NAMESPACE并没有动态的解析出来值，所以我们添加配置这个变量，其实这个变量与DOCKERHUB_NAMESPACE是一样的--只不过现在使用成ALI的了")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6241),alt:"1657530613142"}})]),t._v(" "),e("p",[t._v("​\t\t或者是我们把每个deploy中的每个ALIYUNHUB_NAMESPACE变量修改为DOCKERHUB_NAMESPACE")]),t._v(" "),e("p",[t._v("​\t\t我们重新编辑流水线--将修改后的内容copy进去")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6242),alt:"1657530980997"}})]),t._v(" "),e("p",[t._v("​\t\t再次重新运行--进行流水线工作，之前部署失败的没有事情，因为是同源部署，下次更新是会覆盖的")]),t._v(" "),e("p",[t._v("​\t\t目前显示是容器创建中--之前错误的就会被默认删除掉，新的创建完成后才会删除掉旧的")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6243),alt:"1657531199195"}})]),t._v(" "),e("p",[t._v("​\t\t我们等待了一会发现有个提醒就是----容器没有准备就绪")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6244),alt:"1657531335479"}})]),t._v(" "),e("p",[t._v("​\t\t这个没有事情，我们继续等待就可以--因为我们之前有使用springboot做过探针服务，当容器真正启动成功后--就绪探针 就会显示 准备就绪")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6245),alt:"1657531444210"}})]),t._v(" "),e("p",[t._v("​\t\t经过长时间的启动--发现还是显示这个，我们在本机启动起来一下项目看一下")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6246),alt:"1657531591681"}})]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​\t\t本地的项目启动起来后----我们在本机随便访问一个项目，然后我们访问这个项目的actuator/health，我们发现有些项目打印的是DOWN，有些是UP")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6247),alt:"1657531660326"}})]),t._v(" "),e("p",[t._v("​\t\t如果我们的项目整个Down后，页面的响应也就是503")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6248),alt:"1657531784438"}})]),t._v(" "),e("p",[t._v("​\t\t而k8s认为 2** 的响应码是正确的，5**返回的错误码就认为是错误的，其实整体我们看了一下是我们这个项目有些问题，因为有些微服务项目使用到了redis，但文档中没说，但是在控制台中会报出连向本机的redis的错误")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6249),alt:"1657532655869"}})]),t._v(" "),e("p",[t._v("​\t\t所以我们现在要做的是，我们的项目上云后--都会连接我们的Nacos，而Nacos会连接我们上云的线上环境的配置，那么现在我们就给每个应用，都加上redis的配置")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6250),alt:"1657532845621"}})]),t._v(" "),e("p",[t._v("​\t比如oss--现在没有配置redis，但是其实是实际以后是会使用到的")]),t._v(" "),e("p",[t._v("​\t\tstatistics微服务，test微服务，user微服务")]),t._v(" "),e("p",[t._v("​\t这些我们都加入redis的配置")]),t._v(" "),e("p",[e("img",{attrs:{src:p(6251),alt:"1657534349422"}})]),t._v(" "),e("p",[t._v("​")]),t._v(" "),e("p",[t._v("​\t\t重新运行一下流水线")]),t._v(" "),e("p",[t._v("https://www.bilibili.com/video/BV13Q4y1C7hS?p=120&spm_id_from=pageDriver&vd_source=243ad3a9b323313aa1441e5dd414a4ef")])])}),[],!1,null,null,null);s.default=i.exports}}]);