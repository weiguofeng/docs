(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{7203:function(s,t,a){s.exports=a.p+"assets/img/image-20220424215336316.276396b3.png"},7204:function(s,t,a){s.exports=a.p+"assets/img/image-20220424215417156.403c27ee.png"},7205:function(s,t,a){s.exports=a.p+"assets/img/image-20220424215504017.bb263731.png"},7206:function(s,t,a){s.exports=a.p+"assets/img/image-20220424215536021.9e18bd07.png"},7207:function(s,t,a){s.exports=a.p+"assets/img/image-20220424215640735.2e0efc8a.png"},7208:function(s,t,a){s.exports=a.p+"assets/img/image-20220424215748007.21a0dded.png"},7209:function(s,t,a){s.exports=a.p+"assets/img/image-20220424215954403.523bab7b.png"},7210:function(s,t,a){s.exports=a.p+"assets/img/image-20220424220220917.b9116472.png"},7211:function(s,t,a){s.exports=a.p+"assets/img/image-20220424220438627.263693e8.png"},7212:function(s,t,a){s.exports=a.p+"assets/img/image-20220424220756801.2b76dd20.png"},7213:function(s,t,a){s.exports=a.p+"assets/img/image-20220424220642857.a14ee0a1.png"},7214:function(s,t,a){s.exports=a.p+"assets/img/image-20220424221132572.aff62998.png"},7215:function(s,t,a){s.exports=a.p+"assets/img/image-20220424221254594.6a111c1d.png"},7216:function(s,t,a){s.exports=a.p+"assets/img/image-20220424221356505.3d5ce2b2.png"},7217:function(s,t,a){s.exports=a.p+"assets/img/image-20220424221831974.2f3c1b6a.png"},7218:function(s,t,a){s.exports=a.p+"assets/img/image-20220424221927743.a494a4fc.png"},7219:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222025675.8d342195.png"},7220:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222220330.e82ae11b.png"},7221:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222310352.53e28ae7.png"},7222:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222507092.4964a382.png"},7223:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222552246.47386a19.png"},7224:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222704181.bddfe804.png"},7225:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222808485.a003a6ba.png"},7226:function(s,t,a){s.exports=a.p+"assets/img/image-20220424222928523.5a257f4f.png"},9500:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_21-k8s核心实战-多容器pod细节"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_21-k8s核心实战-多容器pod细节"}},[s._v("#")]),s._v(" 21.k8s核心实战-多容器pod细节")]),s._v(" "),n("p",[s._v("​\t\t之前我们通过命令行的方式或者是配置文件的方式创建了pod。")]),s._v(" "),n("p",[s._v("​\tpod是k8s的最小单元，每一个pod都有一个唯一的k8s分配的IP可以用于访问，集群中都可以访问到，还有就是pod是一组运行的容器。")]),s._v(" "),n("p",[s._v("​\t下面我们看一下如何让一个pod中部署2个或者多个容器")]),s._v(" "),n("p",[s._v("​\t我们再准备一个创建pod的配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    run: mynginx\n  name: mynginx\n#  namespace: default\nspec:\n  containers:\n  - image: nginx\n    name: mynginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myapp\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8.5.68\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tomcat\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("​\t注意俩个pod的name不能一致，就像我们每个宿舍的宿舍号不能一致了")]),s._v(" "),n("p",[s._v("​\t那么在这个pod的配置文件中，我们看到有2个容器，第一个 -image是nginx第二个是tomcat，这就相当于一个宿舍里面有2个人")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7203),alt:"image-20220424215336316"}})]),s._v(" "),n("p",[s._v("我们vi一个pod的配置文件")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7204),alt:"image-20220424215417156"}})]),s._v(" "),n("p",[n("img",{attrs:{src:a(7205),alt:"image-20220424215504017"}})]),s._v(" "),n("p",[s._v("然后应用一下配置文件")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7206),alt:"image-20220424215536021"}})]),s._v(" "),n("p",[s._v("我们看到第二个pod显示的是0/2是因为他启动了2个容器")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7207),alt:"image-20220424215640735"}})]),s._v(" "),n("p",[s._v("我们在可视化界面中看一下，他被分配到了ks8-node1节点上了")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7208),alt:"image-20220424215748007"}})]),s._v(" "),n("p",[s._v("我们可以看到这个pod中有2个容器")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7209),alt:"image-20220424215954403"}})]),s._v(" "),n("p",[s._v("我们查看一下详细信息")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7210),alt:"image-20220424220220917"}})]),s._v(" "),n("p",[s._v("那么我们访问这个192.168.36.68地址到底是访问到nginx还是tomcat呢？")]),s._v(" "),n("p",[s._v("​\tcurl访问得到的是nginx为什么？因为nginx的默认端口是80")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7211),alt:"image-20220424220438627"}})]),s._v(" "),n("p",[s._v("我们访问一下8080端口试一下：访问到了tomcat")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7212),alt:"image-20220424220756801"}})]),s._v(" "),n("p",[n("img",{attrs:{src:a(7213),alt:"image-20220424220642857"}})]),s._v(" "),n("p",[s._v("其实如果是nginx想要访问tomcat如何访问呢？其实就不需要这个ip了，因为他们相当于在一个机器环境下 可以直接使用127.0.0.1:8080访问到tomcat")]),s._v(" "),n("p",[s._v("​\t我们验证一下：我们点击可视化界面的执行（可以选择进入那个容器），进入到nginx中")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7214),alt:"image-20220424221132572"}})]),s._v(" "),n("p",[n("img",{attrs:{src:a(7215),alt:"image-20220424221254594"}})]),s._v(" "),n("p",[s._v("我们访问tomcat发现使用127.0.0.1访问是没有问题的")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7216),alt:"image-20220424221356505"}})]),s._v(" "),n("p",[s._v("​\t还有一个问题，就是如果我们新建了一个pod那么这个pod能不能运行2个nginx？或者2个tomcat等等？")]),s._v(" "),n("p",[s._v("​\t我们现在创建2个nginx容器试一下")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7217),alt:"image-20220424221831974"}})]),s._v(" "),n("p",[s._v("我们等待看创建出来是什么样子的")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7218),alt:"image-20220424221927743"}})]),s._v(" "),n("p",[s._v("我们发现myapp2这个pod是error")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7219),alt:"image-20220424222025675"}})]),s._v(" "),n("p",[s._v("每当有error的时候，我们就需要使用kubectl describe pod podName这个命令查看详情")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7220),alt:"image-20220424222220330"}})]),s._v(" "),n("p",[s._v("​\t或者是我们在可视化界面中找到pod，键入-然后查看事件")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7221),alt:"image-20220424222310352"}})]),s._v(" "),n("p",[s._v("我们看一下命令执行后的提示：容器启动失败")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7222),alt:"image-20220424222507092"}})]),s._v(" "),n("p",[s._v("启动失败的原因就是都使用了80端口在一个容器中--端口被占用")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7223),alt:"image-20220424222552246"}})]),s._v(" "),n("p",[s._v("我们也可以看一下日志：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7224),alt:"image-20220424222704181"}})]),s._v(" "),n("p",[s._v("日志中可以看到地址被占用的错误提示")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7225),alt:"image-20220424222808485"}})]),s._v(" "),n("p",[s._v("如果运行失败，k8s会一直进行重试进行启动pod")]),s._v(" "),n("p",[n("img",{attrs:{src:a(7226),alt:"image-20220424222928523"}})]),s._v(" "),n("p",[s._v("​\t所以要注意：一个pod中有多个容器的话一定要注意端口不能冲突了")]),s._v(" "),n("p",[s._v("https://www.bilibili.com/video/BV13Q4y1C7hS?p=46")])])}),[],!1,null,null,null);t.default=e.exports}}]);