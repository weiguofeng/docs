(window.webpackJsonp=window.webpackJsonp||[]).push([[740],{8471:function(e,s,a){"use strict";a.r(s);var n=a(5),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("title: 2、react中环境变量env加载问题\ndate： 2024-06-13\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h1",{attrs:{id:"_2、react中环境变量env加载问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、react中环境变量env加载问题"}},[e._v("#")]),e._v(" 2、react中环境变量env加载问题")]),e._v(" "),a("p",[e._v("​\t\t\treact中使用.env来管理环境变量，加载会根据优先级进行加载，如果同样的key最终使用优先级高的配置")]),e._v(" "),a("h3",{attrs:{id:"使用-env-文件管理环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-env-文件管理环境变量"}},[e._v("#")]),e._v(" 使用 "),a("code",[e._v(".env")]),e._v(" 文件管理环境变量")]),e._v(" "),a("p",[e._v("在React项目中，"),a("code",[e._v(".env")]),e._v(" 文件用于管理环境变量，可以方便地根据不同环境（如开发、测试、生产）配置不同的参数。下面是如何使用 "),a("code",[e._v(".env")]),e._v(" 文件以及它们的实现原理。")]),e._v(" "),a("h4",{attrs:{id:"_1-创建-env-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建-env-文件"}},[e._v("#")]),e._v(" 1. 创建 "),a("code",[e._v(".env")]),e._v(" 文件")]),e._v(" "),a("p",[e._v("在项目根目录创建一个 "),a("code",[e._v(".env")]),e._v(" 文件，例如：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("bash复制代码# .env\nREACT_APP_API_URL=https://api.example.com\nREACT_APP_API_KEY=your_api_key_here\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("在React项目中，环境变量必须以 "),a("code",[e._v("REACT_APP_")]),e._v(" 开头，这是Create React App（CRA）的限制。")]),e._v(" "),a("h4",{attrs:{id:"_2-使用环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用环境变量"}},[e._v("#")]),e._v(" 2. 使用环境变量")]),e._v(" "),a("p",[e._v("在React代码中，可以通过 "),a("code",[e._v("process.env")]),e._v(" 访问环境变量。例如：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("javascript复制代码// src/App.js\nimport React from 'react';\n\nfunction App() {\n  const apiUrl = process.env.REACT_APP_API_URL;\n  const apiKey = process.env.REACT_APP_API_KEY;\n\n  return (\n    <div className=\"App\">\n      <h1>API URL: {apiUrl}</h1>\n      <h1>API Key: {apiKey}</h1>\n    </div>\n  );\n}\n\nexport default App;\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br")])]),a("h4",{attrs:{id:"_3-加载环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-加载环境变量"}},[e._v("#")]),e._v(" 3. 加载环境变量")]),e._v(" "),a("p",[e._v("当你运行React项目时，Create React App会自动加载根目录中的 "),a("code",[e._v(".env")]),e._v(" 文件，并将其中的变量注入到 "),a("code",[e._v("process.env")]),e._v(" 中。这些变量可以在编译时通过Webpack注入到你的应用中。")]),e._v(" "),a("h4",{attrs:{id:"_4-环境特定的-env-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-环境特定的-env-文件"}},[e._v("#")]),e._v(" 4. 环境特定的 "),a("code",[e._v(".env")]),e._v(" 文件")]),e._v(" "),a("p",[e._v("你可以创建环境特定的 "),a("code",[e._v(".env")]),e._v(" 文件，例如：")]),e._v(" "),a("ul",[a("li",[a("code",[e._v(".env.development")]),e._v("：仅在开发环境中加载。")]),e._v(" "),a("li",[a("code",[e._v(".env.production")]),e._v("：仅在生产环境中加载。")]),e._v(" "),a("li",[a("code",[e._v(".env.test")]),e._v("：仅在测试环境中加载。")])]),e._v(" "),a("p",[e._v("CRA会根据运行时的环境自动加载相应的 "),a("code",[e._v(".env")]),e._v(" 文件。")]),e._v(" "),a("h3",{attrs:{id:"实现原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现原理"}},[e._v("#")]),e._v(" 实现原理")]),e._v(" "),a("h4",{attrs:{id:"_1-webpack的定义插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-webpack的定义插件"}},[e._v("#")]),e._v(" 1. Webpack的定义插件")]),e._v(" "),a("p",[e._v("CRA内部使用Webpack，它通过 "),a("code",[e._v("DefinePlugin")]),e._v(" 插件将环境变量注入到代码中。例如：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("javascript复制代码new webpack.DefinePlugin({\n  'process.env.REACT_APP_API_URL': JSON.stringify(process.env.REACT_APP_API_URL),\n  'process.env.REACT_APP_API_KEY': JSON.stringify(process.env.REACT_APP_API_KEY)\n});\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h4",{attrs:{id:"_2-编译时替换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-编译时替换"}},[e._v("#")]),e._v(" 2. 编译时替换")]),e._v(" "),a("p",[e._v("在编译过程中，Webpack会将代码中的 "),a("code",[e._v("process.env.REACT_APP_API_URL")]),e._v(" 和其他环境变量替换为对应的值。这意味着这些值在构建时就已经固定，而不是在运行时动态加载的。")]),e._v(" "),a("h3",{attrs:{id:"实际应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实际应用场景"}},[e._v("#")]),e._v(" 实际应用场景")]),e._v(" "),a("ol",[a("li",[a("strong",[e._v("API请求")]),e._v("： 使用环境变量来配置API的基础URL和API密钥。")]),e._v(" "),a("li",[a("strong",[e._v("构建配置")]),e._v("： 根据环境切换不同的配置，例如不同的分析工具或调试工具的启用。")]),e._v(" "),a("li",[a("strong",[e._v("其他配置")]),e._v("： 管理任何需要根据环境变化的配置项，如日志级别、特性标志等。")])]),e._v(" "),a("h3",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[e._v("#")]),e._v(" 例子")]),e._v(" "),a("p",[e._v("假设你有一个开发环境和一个生产环境，需要不同的API URL和API Key：")]),e._v(" "),a("p",[a("strong",[e._v(".env.development")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("bash复制代码REACT_APP_API_URL=https://dev-api.example.com\nREACT_APP_API_KEY=dev_api_key\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[a("strong",[e._v(".env.production")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("bash复制代码REACT_APP_API_URL=https://api.example.com\nREACT_APP_API_KEY=prod_api_key\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[a("strong",[e._v("使用环境变量")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("javascript复制代码// src/api.js\nconst apiUrl = process.env.REACT_APP_API_URL;\nconst apiKey = process.env.REACT_APP_API_KEY;\n\nexport const fetchData = async () => {\n  const response = await fetch(`${apiUrl}/data`, {\n    headers: {\n      'Authorization': `Bearer ${apiKey}`\n    }\n  });\n  const data = await response.json();\n  return data;\n};\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])]),a("p",[e._v("这样，通过使用 "),a("code",[e._v(".env")]),e._v(" 文件和环境变量，你可以轻松地管理不同环境下的配置，确保在不同环境中运行时有正确的设置。")]),e._v(" "),a("h3",{attrs:{id:"加载顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载顺序"}},[e._v("#")]),e._v(" 加载顺序")]),e._v(" "),a("ol",[a("li",[a("strong",[a("code",[e._v(".env.local")])]),e._v(" "),a("ul",[a("li",[e._v("总是会加载，无论是在哪种模式下（开发、生产或测试）。")])])]),e._v(" "),a("li",[a("strong",[a("code",[e._v(".env.[mode].local")])]),e._v(" "),a("ul",[a("li",[e._v("例如 "),a("code",[e._v(".env.development.local")]),e._v("，"),a("code",[e._v(".env.production.local")]),e._v("，仅在特定模式下加载。")])])]),e._v(" "),a("li",[a("strong",[a("code",[e._v(".env")])]),e._v(" "),a("ul",[a("li",[e._v("总是会加载，无论是在哪种模式下（开发、生产或测试）。")])])]),e._v(" "),a("li",[a("strong",[a("code",[e._v(".env.[mode]")])]),e._v(" "),a("ul",[a("li",[e._v("例如 "),a("code",[e._v(".env.development")]),e._v("，"),a("code",[e._v(".env.production")]),e._v("，仅在特定模式下加载。")])])])]),e._v(" "),a("h3",{attrs:{id:"使用实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用实例"}},[e._v("#")]),e._v(" 使用实例")]),e._v(" "),a("p",[e._v("假设你的项目有以下环境变量文件：")]),e._v(" "),a("ul",[a("li",[a("code",[e._v(".env")])]),e._v(" "),a("li",[a("code",[e._v(".env.development")])]),e._v(" "),a("li",[a("code",[e._v(".env.production")])]),e._v(" "),a("li",[a("code",[e._v(".env.local")])]),e._v(" "),a("li",[a("code",[e._v(".env.development.local")])]),e._v(" "),a("li",[a("code",[e._v(".env.production.local")])])]),e._v(" "),a("p",[e._v("当你在开发模式下运行项目时（例如使用 "),a("code",[e._v("npm start")]),e._v("），CRA 会按以下顺序加载这些文件：")]),e._v(" "),a("ol",[a("li",[a("code",[e._v(".env")])]),e._v(" "),a("li",[a("code",[e._v(".env.development")])]),e._v(" "),a("li",[a("code",[e._v(".env.local")])]),e._v(" "),a("li",[a("code",[e._v(".env.development.local")])])]),e._v(" "),a("p",[e._v("如果在生产模式下运行项目（例如使用 "),a("code",[e._v("npm run build")]),e._v("），CRA 会按以下顺序加载这些文件：")]),e._v(" "),a("ol",[a("li",[a("code",[e._v(".env")])]),e._v(" "),a("li",[a("code",[e._v(".env.production")])]),e._v(" "),a("li",[a("code",[e._v(".env.local")])]),e._v(" "),a("li",[a("code",[e._v(".env.production.local")])])]),e._v(" "),a("h3",{attrs:{id:"文件内容示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件内容示例"}},[e._v("#")]),e._v(" 文件内容示例")]),e._v(" "),a("p",[a("strong",[e._v(".env")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("env复制代码REACT_APP_API_URL=https://default-api.example.com\nREACT_APP_FEATURE_FLAG=true\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[a("strong",[e._v(".env.development")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("env\n复制代码\nREACT_APP_API_URL=https://dev-api.example.com\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[a("strong",[e._v(".env.production")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("env\n复制代码\nREACT_APP_API_URL=https://prod-api.example.com\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[a("strong",[e._v(".env.local")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("env\n复制代码\nREACT_APP_API_KEY=local_api_key\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[a("strong",[e._v(".env.development.local")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("env\n复制代码\nREACT_APP_SECRET_KEY=dev_secret_key\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[a("strong",[e._v(".env.production.local")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("env\n复制代码\nREACT_APP_SECRET_KEY=prod_secret_key\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("在开发模式下，"),a("code",[e._v("process.env")]),e._v(" 中的变量将会是：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('javascript复制代码{\n  REACT_APP_API_URL: "https://dev-api.example.com",\n  REACT_APP_FEATURE_FLAG: "true",\n  REACT_APP_API_KEY: "local_api_key",\n  REACT_APP_SECRET_KEY: "dev_secret_key"\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("p",[e._v("在生产模式下，"),a("code",[e._v("process.env")]),e._v(" 中的变量将会是：")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('javascript复制代码{\n  REACT_APP_API_URL: "https://prod-api.example.com",\n  REACT_APP_FEATURE_FLAG: "true",\n  REACT_APP_API_KEY: "local_api_key",\n  REACT_APP_SECRET_KEY: "prod_secret_key"\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h3",{attrs:{id:"注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[e._v("#")]),e._v(" 注意事项")]),e._v(" "),a("ul",[a("li",[e._v("环境变量文件中变量名必须以 "),a("code",[e._v("REACT_APP_")]),e._v(" 开头，CRA 只会注入这些变量。")]),e._v(" "),a("li",[a("code",[e._v(".env.local")]),e._v(" 文件通常用于本地开发，且不应被提交到版本控制中，因为它可能包含敏感信息或个人配置。")]),e._v(" "),a("li",[e._v("可以通过 "),a("code",[e._v(".gitignore")]),e._v(" 文件忽略 "),a("code",[e._v(".env.local")]),e._v(" 文件。")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("gitignore复制代码# .gitignore\n.env.local\n.env.*.local\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("通过这种方式，你可以灵活地管理不同环境下的配置，并确保在开发、测试和生产环境中使用正确的变量。")])])}),[],!1,null,null,null);s.default=t.exports}}]);